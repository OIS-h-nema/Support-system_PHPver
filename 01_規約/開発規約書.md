# サポート報告書WEBシステム 開発規約書

**作成日**: 2025-11-20  
**バージョン**: 1.1  
**Phase**: 02

---

## 1. プロジェクト概要

### 1.1 目的
現在MS Accessで稼働しているサポート報告書管理システムをWEB化し、社内ネットワーク上で利用可能にする。

### 1.2 基本方針
- **既存資産の活用**: SQL Serverデータベースとストアドプロシージャをそのまま継承
- **標準技術の採用**: PHP + HTML + CSS + jQueryによる標準的なWEBアプリケーション構成
- **参考システムの活用**: 既存のois-webシステムの構造・関数を参考にする
- **段階的開発**: フェーズごとに機能を分割し、確実に進行する

---

## 2. 技術スタック

### 2.1 開発環境
- **WEBサーバー**: IIS（Windows Server）
- **PHPバージョン**: PHP 7.4以上
- **データベース**: SQL Server 2022
- **文字コード**: UTF-8

### 2.2 フロントエンド
- **HTML**: HTML5 / XHTML 1.0 Transitional
- **CSS**: レスポンシブ対応（PC / Tablet / SP用のCSSを分離）
- **JavaScript**: jQuery 1.11系
- **CSSフレームワーク**: 独自CSS（参考システムを踏襲）

### 2.3 バックエンド
- **言語**: PHP 7.4
- **DB接続**: PDO（SQL Server Native Client）
- **セッション管理**: PHP標準セッション（タイムアウト: 9時間）
- **データ操作**: ストアドプロシージャ優先、必要に応じてPHP処理

---

## 3. ファイル命名規則

### 3.1 PHPファイル
- **メイン画面**: `[機能名]_main.php`
  - 例: `support_main.php`
- **一覧画面**: `[機能名]_list.php`
  - 例: `support_list.php`
- **登録画面**: `[機能名]_ins.php`
  - 例: `support_ins.php`
- **更新画面**: `[機能名]_upd.php`
  - 例: `support_upd.php`
- **検索画面**: `[機能名]_kensaku[番号].php`
  - 例: `support_kensaku01.php`
- **サブ処理**: `[機能名]_sub[番号].php`
  - 例: `support_sub01.php`
- **Ajax処理**: `[機能名]_ajax[番号].php`
  - 例: `support_ajax01.php`

### 3.2 CSSファイル
- **PC用**: `pc.css`
- **タブレット用**: `tablet.css`
- **スマートフォン用**: `sp.css`
- **機能別CSS**: `[機能名].css`

### 3.3 JavaScriptファイル
- **外部ライブラリ**: `js/` ディレクトリに配置
- **独自スクリプト**: `js/custom.js`

### 3.4 画像ファイル
- **配置先**: `images/` ディレクトリ
- **命名**: 小文字英数字とハイフンを使用
  - 例: `button-submit.png`, `icon-edit.png`

---

## 4. コーディング規約

### 4.1 PHP規約

#### 4.1.1 基本規則
```php
<?php
// ファイルヘッダーコメント
/*
 * ファイル名: support_main.php
 * 機能: サポート報告書メイン画面
 * 作成日: YYYY-MM-DD
 * 更新履歴:
 *   YYYY-MM-DD: 初版作成
 */

// 共通インクルード
require_once("../../func/inc.php");
require_once("../../func/myFunction.php");
require_once("../../func/myConvert.php");

// 変数の初期化
$err_msg = array();
$msg = array();
$FLG = true;
```

#### 4.1.2 変数命名規則
- **グローバル変数**: `$変数名` （小文字スネークケース）
  - 例: `$user_name`, `$error_message`
- **定数**: `定義名` （大文字スネークケース）
  - 例: `HANBAITEN_CODE`, `MAX_RECORDS`
- **セッション変数**: `$_SESSION['キー名']` （大文字スネークケース）
  - 例: `$_SESSION['LOGIN']`, `$_SESSION['USER_ID']`

#### 4.1.3 データベース接続
```php
// PDO接続は inc.php で確立済み
// グローバル変数 $pdo_conn を使用

// プリペアドステートメントの使用
$sql = 'SELECT * FROM テーブル名 WHERE コード = ?';
$stmt = $pdo_conn->prepare($sql);
$stmt->execute(array($code));
while($row = $stmt->fetch(PDO::FETCH_NUM)){
    // 処理
}
```

#### 4.1.4 エラー処理
```php
// エラーメッセージは配列で管理
if ($validation_error) {
    $err_msg[] = 'エラーメッセージ';
}

// 画面表示時
if (count($err_msg) > 0) {
    for($i=0; $i<count($err_msg); $i++) {
        echo "<p class=\"error\">【エラー】".$err_msg[$i]."</p>";
    }
}
```

#### 4.1.5 サニタイズ処理
```php
// ユーザー入力は必ずサニタイズ
$input_value = chkSunitize($_POST['input_name']);

// 関数定義（myFunction.phpに定義済み）
function chkSunitize($str){
    $str = htmlspecialchars($str, ENT_QUOTES);
    return ($str);
}
```

### 4.2 HTML規約

#### 4.2.1 基本構造
```html
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1" />
<meta name="format-detection" content="telephone=no" />

<!-- CSS -->
<link rel="stylesheet" href="pc.css" type="text/css" />
<link rel="stylesheet" href="tablet.css" type="text/css" />
<link rel="stylesheet" href="sp.css" type="text/css" />

<!-- JavaScript -->
<script type="text/javascript" src="js/jquery.js"></script>

<title>システム名 | 画面名</title>
</head>
<body>
<!-- コンテンツ -->
</body>
</html>
```

#### 4.2.2 レスポンシブ対応
- ビューポート設定を必ず記述
- PC / Tablet / SP用のCSSを個別に読み込み
- メディアクエリを活用してデバイスごとに表示を最適化

### 4.3 JavaScript/jQuery規約

#### 4.3.1 基本規則
```javascript
// ドキュメント準備完了後に実行
$(document).ready(function(){
    // 初期化処理
});

// または
$(function(){
    // 初期化処理
});
```

#### 4.3.2 イベントハンドラ
```javascript
// Enterキー制御
$("#input_field").keydown(function(e) {
    if ((e.which && e.which === 13) || (e.keyCode && e.keyCode === 13)) {
        // Enter押下時の処理
        return false; // デフォルト動作を抑制
    }
});

// クリックイベント
$("#button_id").on('click', function(){
    // クリック時の処理
});
```

#### 4.3.3 Ajax通信
```javascript
$.ajax({
    type: 'POST',
    url: 'target_file.php',
    dataType: 'text',
    data: {
        'param1': value1,
        'param2': value2
    },
    success: function(response){
        // 成功時の処理
    },
    error: function(response){
        // エラー時の処理
        alert('通信エラーが発生しました');
    }
});
```

### 4.4 CSS規約

#### 4.4.1 命名規則
- **クラス名**: 小文字英数字とハイフンを使用
  - 例: `.button-submit`, `.error-message`
- **ID名**: キャメルケースを使用
  - 例: `#mainContent`, `#searchForm`

#### 4.4.2 レスポンシブ設計
```css
/* PC用 (pc.css) */
@media screen and (min-width: 1025px) {
    /* PC専用スタイル */
}

/* タブレット用 (tablet.css) */
@media screen and (min-width: 768px) and (max-width: 1024px) {
    /* タブレット専用スタイル */
}

/* スマートフォン用 (sp.css) */
@media screen and (max-width: 767px) {
    /* SP専用スタイル */
}
```

---

## 5. セキュリティ規約

### 5.1 基本方針
- 社内ネットワーク限定のため、外部攻撃への対策は最小限
- ただし、基本的なセキュリティ対策は実施

### 5.2 実装事項
1. **入力値検証**: 全ての入力値をサニタイズ（htmlspecialchars）
2. **SQLインジェクション対策**: プリペアドステートメントを使用
3. **セッション管理**: タイムアウト設定（9時間）
4. **XSS対策**: 出力時にエスケープ処理
5. **CSRF対策**: 今回は省略（社内限定のため）

---

## 6. データベース規約

### 6.1 接続情報
- 接続設定は `inc.php` で一元管理
- DSN形式: `sqlsrv:server=サーバー名;Database=データベース名`

### 6.2 テーブル命名規則
- **マスタテーブル**: `M_[テーブル名]`
  - 例: `M_担当者`, `M_顧客分類`
- **データテーブル**: `D_[テーブル名]`
  - 例: `D_サポート報告書`, `D_対応履歴`
- **システムテーブル**: `SYS_[テーブル名]`
  - 例: `SYS_アカウント`

### 6.3 ストアドプロシージャ

#### 6.3.1 既存SPの使用
既存のストアドプロシージャをそのまま使用する。主要なSPは以下の通り：

**一覧取得系**
- `SEL_D_サポート報告書_一覧`: サポート報告書の一覧を取得（検索条件対応）
- `SEL_M_定型文`: 定型文マスタの取得
- `SEL_M_商品`: 商品マスタの取得

**データ操作系**
- `INS_D_サポート報告書`: 新規登録
- `UPD_D_サポート報告書`: 更新
- `DEL_D_サポート報告書`: 削除

**マスタ保守系**
- `INS_M_定型文`, `UPD_M_定型文`, `DEL_M_定型文`
- `INS_M_商品`, `UPD_M_商品`, `DEL_M_商品`
- `INS_M_対応区分`, `UPD_M_対応区分`, `DEL_M_対応区分`
- `INS_M_対応内容項目`, `UPD_M_対応内容項目`, `DEL_M_対応内容項目`

#### 6.3.2 SPの呼び出し方法
```php
// ストアドプロシージャの実行例
$stmt = $pdo_conn->prepare("EXEC dbo.SEL_D_サポート報告書_一覧 @受付日開始 = ?, @受付日終了 = ?");
$stmt->execute(array($start_date, $end_date));
$results = $stmt->fetchAll(PDO::FETCH_ASSOC);
```

#### 6.3.3 新規作成が必要な場合
- 命名規則: `SP_[処理内容]`
- 例: `SP_サポート報告書統計取得`

### 6.4 データベース接続処理の実装

#### 6.4.1 ページング処理
```php
// ページング用のSQL（OFFSET-FETCH使用）
$offset = ($page - 1) * $limit;
$sql = "SELECT * FROM D_サポート報告書 ORDER BY 受付日 DESC OFFSET ? ROWS FETCH NEXT ? ROWS ONLY";
$stmt = $pdo_conn->prepare($sql);
$stmt->execute(array($offset, $limit));
```

#### 6.4.2 トランザクション処理
```php
try {
    $pdo_conn->beginTransaction();
    
    // 複数の処理
    $stmt1 = $pdo_conn->prepare("INSERT ...");
    $stmt1->execute($data1);
    
    $stmt2 = $pdo_conn->prepare("UPDATE ...");
    $stmt2->execute($data2);
    
    $pdo_conn->commit();
} catch (Exception $e) {
    $pdo_conn->rollBack();
    $err_msg[] = "データベースエラー: " . $e->getMessage();
}
```

---

## 7. エラーハンドリング

### 7.1 エラーレベル
- **開発時**: すべてのエラーを表示
- **本番時**: 重大なエラーのみログに記録

### 7.2 エラー表示
```php
// 開発時（inc.phpで設定）
error_reporting(E_ALL ^ E_NOTICE);
ini_set('display_errors', 'On');

// エラーメッセージの表示
if (count($err_msg) > 0) {
    echo '<div class="error-box">';
    for($i=0; $i<count($err_msg); $i++) {
        echo '<p>【エラー】'.$err_msg[$i].'</p>';
    }
    echo '</div>';
}
```

---

## 8. テスト規約

### 8.1 テスト環境
- **検証環境**: `\\LPG-NEMA\C\inetpub\wwwroot\support-system\`
- **本番環境**: `\\DEV-SE\C\inetpub\wwwroot\support-system\`

### 8.2 テスト項目
1. **機能テスト**: 各機能が正常に動作するか
2. **画面表示テスト**: PC / Tablet / SPで表示確認
3. **DB接続テスト**: データの登録・更新・削除・検索
4. **エラーハンドリングテスト**: 異常系の動作確認

---

## 9. バージョン管理

### 9.1 ファイルヘッダー
```php
/*
 * ファイル名: support_main.php
 * バージョン: 1.0.0
 * 作成日: 2025-11-20
 * 更新履歴:
 *   2025-11-20 v1.0.0: 初版作成
 *   2025-11-21 v1.0.1: ○○機能を追加
 */
```

### 9.2 バージョン番号規則
- メジャーバージョン.マイナーバージョン.パッチバージョン
- 例: 1.0.0 → 1.0.1 → 1.1.0 → 2.0.0

---

## 10. ドキュメント管理

### 10.1 必須ドキュメント
1. **開発規約書**（本ドキュメント）
2. **コーディング規約書**
3. **ディレクトリ構造設計書**
4. **機能仕様書**
5. **画面仕様書**
6. **データベース設計書**
7. **テスト仕様書**

### 10.2 ドキュメント形式
- Markdown形式（.md）で作成
- 図表はMarkdown表記または画像ファイルを使用

---

## 11. 共通関数

### 11.1 利用可能な共通関数（myFunction.php）

#### 11.1.1 既存関数
- `chkSunitize($str)`: HTMLエスケープ処理
- `br_convert($str)`: 改行を`<br />`に変換
- `nr_convert($str)`: `<br />`を改行に変換
- `myRound($val, $pos)`: 四捨五入
- `myRoundDown($val, $pos)`: 切り捨て
- `myRoundUp($val, $pos)`: 切り上げ
- `to_wareki($format, $time)`: 西暦→和暦変換
- `Nz($value, $default)`: Null値の置換
- `Ez($value, $default)`: 空文字の置換

#### 11.1.2 追加が必要な共通関数（VBA互換関数）

**日付処理関数**
```php
/**
 * 現在の日付を取得（VBA Date関数相当）
 * @return string 'Y-m-d' 形式の日付
 */
function getCurrentDate() {
    return date('Y-m-d');
}

/**
 * 現在の日時を取得（VBA Now関数相当）
 * @return string 'Y-m-d H:i:s' 形式の日時
 */
function getCurrentDateTime() {
    return date('Y-m-d H:i:s');
}

/**
 * 日付の差分を計算（VBA DateDiff相当）
 * @param string $date1 開始日
 * @param string $date2 終了日
 * @return int 日数の差
 */
function dateDiff($date1, $date2) {
    $datetime1 = new DateTime($date1);
    $datetime2 = new DateTime($date2);
    $interval = $datetime1->diff($datetime2);
    return $interval->days;
}

/**
 * 日付の加算（VBA DateAdd相当）
 * @param string $date 基準日
 * @param int $days 加算日数
 * @return string 'Y-m-d' 形式の日付
 */
function dateAdd($date, $days) {
    $datetime = new DateTime($date);
    $datetime->modify("+{$days} days");
    return $datetime->format('Y-m-d');
}

/**
 * 年を取得（VBA Year関数相当）
 * @param string $date 日付
 * @return int 年
 */
function getYear($date) {
    return (int)date('Y', strtotime($date));
}

/**
 * 月を取得（VBA Month関数相当）
 * @param string $date 日付
 * @return int 月
 */
function getMonth($date) {
    return (int)date('m', strtotime($date));
}

/**
 * 日を取得（VBA Day関数相当）
 * @param string $date 日付
 * @return int 日
 */
function getDay($date) {
    return (int)date('d', strtotime($date));
}
```

**文字列処理関数**
```php
/**
 * 左からn文字取得（VBA Left関数相当）
 * @param string $str 対象文字列
 * @param int $length 取得文字数
 * @return string
 */
function left($str, $length) {
    return mb_substr($str, 0, $length, 'UTF-8');
}

/**
 * 右からn文字取得（VBA Right関数相当）
 * @param string $str 対象文字列
 * @param int $length 取得文字数
 * @return string
 */
function right($str, $length) {
    return mb_substr($str, -$length, $length, 'UTF-8');
}

/**
 * 中間n文字取得（VBA Mid関数相当）
 * @param string $str 対象文字列
 * @param int $start 開始位置（1始まり）
 * @param int $length 取得文字数
 * @return string
 */
function mid($str, $start, $length = null) {
    $start = $start - 1; // 0始まりに変換
    if ($length === null) {
        return mb_substr($str, $start, null, 'UTF-8');
    }
    return mb_substr($str, $start, $length, 'UTF-8');
}

/**
 * 文字列の長さを取得（VBA Len関数相当）
 * @param string $str 対象文字列
 * @return int
 */
function len($str) {
    return mb_strlen($str, 'UTF-8');
}

/**
 * トリム（VBA Trim関数相当）
 * @param string $str 対象文字列
 * @return string
 */
function trimStr($str) {
    return trim($str);
}
```

**変換関数**
```php
/**
 * 全角カタカナを半角カタカナに変換
 * @param string $str 対象文字列
 * @return string
 */
function zenkakuToHankaku($str) {
    return mb_convert_kana($str, 'k', 'UTF-8');
}

/**
 * 半角カタカナを全角カタカナに変換
 * @param string $str 対象文字列
 * @return string
 */
function hankakuToZenkaku($str) {
    return mb_convert_kana($str, 'K', 'UTF-8');
}

/**
 * 数値フォーマット（カンマ区切り）
 * @param mixed $value 数値
 * @param int $decimals 小数点以下の桁数
 * @return string
 */
function formatNumber($value, $decimals = 0) {
    return number_format($value, $decimals);
}
```

### 11.2 共通設定（inc.php）
- セッション管理
- 文字コード設定（UTF-8）
- タイムゾーン設定（Asia/Tokyo）
- PDOデータベース接続
- エラーレベル設定

---

## 12. 参考システムからの継承

### 12.1 ois-webシステムの設計思想
- ヘッダー・コンテンツ・フッターの3層構造
- アコーディオンメニューの活用
- モーダルダイアログの使用
- Ajax非同期通信
- レスポンシブデザイン

### 12.2 継承する機能
- ログイン認証機能
- セッション管理
- データベース接続管理
- 共通関数の利用
- CSSレイアウト設計

---

## 13. VBA処理のPHP化方針（Phase 02追加）

### 13.1 基本方針
AccessのVBA処理をPHPで再現する際の方針を以下に定める。

### 13.2 主要処理の実装方針

#### 13.2.1 初期値設定
**VBA処理**:
- フォーム読み込み時に現在日付や担当者コードを自動設定
- デフォルト値の設定

**PHP実装**:
```php
// 初期値設定
$default_date = date('Y-m-d'); // 現在日付
$default_tantousha = $_SESSION['TANTOUSHA_CODE']; // ログインユーザー
$default_taiou_kubun = ''; // 空白
```

#### 13.2.2 商品選択（最大3件）
**VBA処理**:
- ダイアログで商品を選択
- 3件まで選択可能
- 商品コードと商品名を格納

**PHP実装**:
```php
// JavaScriptのモーダルダイアログで実装
// Ajax通信で商品一覧を取得
// 選択結果をhidden項目に格納
```

#### 13.2.3 定型文選択
**VBA処理**:
- ダイアログで定型文を選択
- 選択した定型文を対応内容に挿入

**PHP実装**:
```php
// JavaScriptのモーダルダイアログで実装
// Ajax通信で定型文一覧を取得
// 選択結果を対応内容テキストエリアに挿入
```

#### 13.2.4 対応内容チェックボックス（20項目）
**VBA処理**:
- チェックボックスの状態をビットマスクで保存

**PHP実装**:
```php
// チェックボックスの値を配列で受け取り
$taiou_naiyo_items = isset($_POST['taiou_naiyo']) ? $_POST['taiou_naiyo'] : array();

// ビットマスクに変換してDBに保存
$bitmask = 0;
foreach ($taiou_naiyo_items as $item) {
    $bitmask |= (1 << ($item - 1));
}

// DBから取得時はビットマスクを配列に変換
$checked_items = array();
for ($i = 1; $i <= 20; $i++) {
    if ($bitmask & (1 << ($i - 1))) {
        $checked_items[] = $i;
    }
}
```

#### 13.2.5 入力チェック
**VBA処理**:
- 必須項目チェック
- 日付の妥当性チェック
- 文字数制限チェック

**PHP実装**:
```php
// サーバーサイドバリデーション
$err_msg = array();

// 必須チェック
if (empty($_POST['uketsuke_date'])) {
    $err_msg[] = '受付日を入力してください。';
}

// 日付妥当性チェック
if (!empty($_POST['uketsuke_date'])) {
    $date = DateTime::createFromFormat('Y-m-d', $_POST['uketsuke_date']);
    if (!$date || $date->format('Y-m-d') !== $_POST['uketsuke_date']) {
        $err_msg[] = '受付日の形式が正しくありません。';
    }
}

// 文字数制限
if (mb_strlen($_POST['taiou_naiyo'], 'UTF-8') > 1000) {
    $err_msg[] = '対応内容は1000文字以内で入力してください。';
}
```

#### 13.2.6 データ保存処理
**VBA処理**:
- フォームの値を取得
- ストアドプロシージャを実行
- 成功・失敗メッセージを表示

**PHP実装**:
```php
try {
    // ストアドプロシージャの実行
    $stmt = $pdo_conn->prepare("EXEC dbo.INS_D_サポート報告書 @受付日 = ?, @商品コード1 = ?, ...");
    $stmt->execute(array(
        $_POST['uketsuke_date'],
        $_POST['shouhin_code1'],
        // 以下、全パラメータ
    ));
    
    $msg[] = 'サポート報告書を登録しました。';
} catch (PDOException $e) {
    $err_msg[] = 'データベースエラー: ' . $e->getMessage();
}
```

### 13.3 画面遷移の実装

#### 13.3.1 一覧からの詳細表示
```php
// GETパラメータでIDを渡す
// support_main.php?id=12345
$support_id = isset($_GET['id']) ? intval($_GET['id']) : 0;

if ($support_id > 0) {
    // データ取得処理
}
```

#### 13.3.2 新規登録・更新後の遷移
```php
// 登録・更新成功後は一覧画面へリダイレクト
header('Location: support_main.php?msg=success');
exit;
```

---

## 14. Ajax通信の実装規約（Phase 02追加）

### 14.1 Ajax処理ファイルの作成

#### 14.1.1 命名規則
- `[機能名]_ajax[番号].php`
- 例: `support_ajax01.php` （商品検索）
- 例: `support_ajax02.php` （定型文取得）

#### 14.1.2 基本構造
```php
<?php
require_once("../../func/inc.php");

// POSTデータの取得
$action = isset($_POST['action']) ? $_POST['action'] : '';

// 処理分岐
switch ($action) {
    case 'get_product':
        // 商品検索処理
        $keyword = isset($_POST['keyword']) ? $_POST['keyword'] : '';
        // DB検索
        // 結果をJSONで返却
        echo json_encode($results);
        break;
    
    case 'get_template':
        // 定型文取得処理
        $template_code = isset($_POST['code']) ? $_POST['code'] : '';
        // DB検索
        // 結果をJSONで返却
        echo json_encode($result);
        break;
    
    default:
        echo json_encode(array('error' => 'Invalid action'));
        break;
}
?>
```

### 14.2 JavaScript側の実装
```javascript
// 商品検索のAjax通信
$.ajax({
    type: 'POST',
    url: 'support_ajax01.php',
    dataType: 'json',
    data: {
        action: 'get_product',
        keyword: $('#product_keyword').val()
    },
    success: function(response){
        // 検索結果を表示
        displayProductList(response);
    },
    error: function(){
        alert('商品検索でエラーが発生しました。');
    }
});
```

### 14.3 セキュリティ対策
- Ajaxファイルでもセッションチェックを実施
- 入力値のサニタイズを実施
- JSONエンコード時は適切にエスケープ

---

## 15. ページング処理の実装規約（Phase 02追加）

### 15.1 ページング方式
SQL ServerのOFFSET-FETCH句を使用したページング

### 15.2 実装例
```php
// ページ番号とページサイズの取得
$page = isset($_GET['page']) ? max(1, intval($_GET['page'])) : 1;
$page_size = 50; // 1ページあたり50件

// オフセット計算
$offset = ($page - 1) * $page_size;

// SQLの実行
$sql = "
    SELECT * 
    FROM D_サポート報告書
    WHERE 削除フラグ = 0
    ORDER BY 受付日 DESC, 報告書ID DESC
    OFFSET ? ROWS FETCH NEXT ? ROWS ONLY
";
$stmt = $pdo_conn->prepare($sql);
$stmt->execute(array($offset, $page_size));
$results = $stmt->fetchAll(PDO::FETCH_ASSOC);

// 総件数の取得
$sql_count = "SELECT COUNT(*) FROM D_サポート報告書 WHERE 削除フラグ = 0";
$stmt_count = $pdo_conn->query($sql_count);
$total_count = $stmt_count->fetchColumn();

// 総ページ数の計算
$total_pages = ceil($total_count / $page_size);
```

### 15.3 ページネーション表示
```php
// ページリンクの生成
echo '<div class="pagination">';
if ($page > 1) {
    echo '<a href="?page='.($page-1).'">前へ</a>';
}

for ($i = 1; $i <= $total_pages; $i++) {
    if ($i == $page) {
        echo '<span class="current">'.$i.'</span>';
    } else {
        echo '<a href="?page='.$i.'">'.$i.'</a>';
    }
}

if ($page < $total_pages) {
    echo '<a href="?page='.($page+1).'">次へ</a>';
}
echo '</div>';
```

---

## 16. データ移行規約（Phase 02追加）

### 16.1 基本方針
- AccessローカルテーブルSQL_*は使用停止
- SQL Serverテーブルのみを使用
- データ移行作業は不要（同一DB使用のため）

### 16.2 使用停止テーブル
以下のAccessローカルテーブルは使用しない：
- `SQL_M_対応内容項目`
- `SQL_M_定型文`
- `SQL_M_顧客分類`
- `SQL_M_商品`

### 16.3 代替方法
全てSQL Serverテーブルから直接取得する：
- `M_対応内容項目`
- `M_定型文`
- `M_顧客分類`
- `M_商品`

---

## 17. 備考

### 17.1 注意事項
- Windows環境のため、パスは円マーク（`\`）を使用
- SQL Serverの日本語カラム名に対応
- セッションタイムアウトは9時間（32400秒）
- キャッシュコントロールはHTTPヘッダーで制御

### 17.2 今後の拡張
- 将来的な機能追加に備えた拡張性の確保
- モジュール化による保守性の向上
- 段階的なセキュリティ強化の可能性

---

**承認**: Phase 02完了時  
**改訂履歴**: 
- v1.0 (2025-11-20): 初版作成（Phase 01）
- v1.1 (2025-11-21): Phase 02の分析結果を反映（VBA処理のPHP化方針、Ajax通信規約、ページング規約、データ移行規約を追加）
