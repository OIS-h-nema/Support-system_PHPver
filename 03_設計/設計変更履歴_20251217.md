# 設計変更履歴 - 2025/12/17〜12/19

## 変更概要
ダイアログ画面の共通仕様を変更し、UIの統一性を向上

## 変更内容

### 1. 「閉じる」「キャンセル」ボタンの廃止
- **対象**: 全てのダイアログ画面（入力ダイアログ、マスタ画面）
- **変更前**: フッター領域に「閉じる」または「キャンセル」ボタンを配置
- **変更後**: ヘッダー右上の「×」ボタンのみに統一
- **理由**: UI操作の簡素化とダイアログ閉じる動作の一元化

### 2. マスタ画面ヘッダーエリアの削除
- **対象**: 商品マスタ、定型文マスタ、対応区分マスタ、対応内容項目マスタ
- **変更前**: 各マスタ画面に独自のヘッダー「マスタ設定 - ○○」と「閉じる」ボタンを配置
- **変更後**: ヘッダーエリアを完全に削除、タイトルと閉じるボタンは親モーダルに委譲
- **理由**: iframeモーダルとして呼び出される際の二重ヘッダーを解消

### 3. ダイアログヘッダーの統一
- **対象**: 入力ダイアログ、マスタ画面を呼び出す親モーダル
- **変更内容**: 
  - 文字サイズ: 18px
  - ヘッダー縦幅: padding 15px 20px
  - 背景色: #2563eb（入力ダイアログ基準）
  - 「×」ボタン: 右上に配置、24px、白文字
- **理由**: 全ダイアログの見た目を統一

---

## 2025-12-19 追加修正

### 4. 商品マスタの新規登録不具合修正
- **問題**: 商品マスタで新規データを登録しても、レコードが追加されない
- **原因**: 
  1. JavaScript側(`ProductMaster.getFormData()`)で`code`パラメータを送信していなかった
  2. PHP側で`$_POST['name']`の存在チェックが不十分だった
- **修正内容**:
  - `js/master.js`: `ProductMaster.getFormData()`に`code`フィールドを追加
  - `master_ajax.php`: `saveProduct()`関数で`$_POST['name']`の存在チェックを追加
  - 保存結果のログ出力を強化（rowCount確認）

### 5. 保存・削除結果のアラート表示追加
- **対象**: 全マスタ画面（商品、定型文、対応区分、対応内容項目）
- **変更内容**:
  - 保存成功時: `alert('登録しました。')` または `alert('更新しました。')`
  - 保存失敗時: `alert('エラー: ' + エラーメッセージ)`
  - 削除成功時: `alert('削除しました。')`
  - 削除失敗時: `alert('エラー: ' + エラーメッセージ)`
- **修正ファイル**: `js/master.js`

## 影響範囲

### 設計書
- `03_設計/画面設計書/master.md` - v1.1へ更新
- `03_設計/画面設計書/input_dialog.md` - v1.1へ更新

### 実装ファイル（変更が必要なファイル）
- `master_shohin.php` - ヘッダー削除
- `master_teikei.php` - ヘッダー削除
- `master_kubun.php` - ヘッダー削除
- `master_content.php` - ヘッダー削除
- `css/master.css` - ヘッダー関連スタイル調整
- `support_dialog.php` - キャンセルボタン削除（入力ダイアログ）
- `css/dialog.css` - フッターボタン関連スタイル調整
- `support_main.php` - マスタモーダル呼び出し時のヘッダー追加
- `js/main.js` - モーダル制御の調整
- **`js/master.js`** - 保存処理修正、アラート表示追加 (2025-12-19)
- **`master_ajax.php`** - 保存処理のバグ修正 (2025-12-19)

## 備考
- 入力ダイアログの「×」ボタンは既に実装済み
- マスタ画面の親モーダルヘッダー実装が必要
- ESCキーでの閉じる機能は維持

---

**作成日**: 2025-12-17  
**更新日**: 2025-12-19  
**作成者**: Claude AI
