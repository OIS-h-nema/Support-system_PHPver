# 入力ダイアログ設計書

**作成日**: 2025-11-25  
**バージョン**: 1.1  
**Phase**: 03  
**画面ID**: input_dialog  
**ファイル名**: support_input.php（モーダル部分）

---

## 1. 概要

### 1.1 画面の目的
サポート報告書の新規登録および既存データの編集を行うモーダルダイアログ。

### 1.2 画面の役割
- サポート報告書の新規登録
- サポート報告書の編集・更新
- サポート報告書の削除
- 顧客検索・選択
- 定型文選択・挿入
- 商品選択（最大3件）

### 1.3 呼び出し条件
- メイン画面の「新規入力」ボタン → 新規登録モード
- メイン画面の「編集」ボタン → 編集モード（SEQNO指定）

---

## 2. レイアウト設計

### 2.1 PC版レイアウト（1025px以上）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        【オーバーレイ（半透明黒）】                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ サポート報告書入力                                         [×]  │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │                                                                 │   │
│  │  顧客コード *  [_____] [検索]   顧客名: 株式会社○○○○          │   │
│  │                                                                 │   │
│  │  部門 *       [LPG支援部        ▼]                             │   │
│  │                                                                 │   │
│  │  顧客担当者名  [____________________]                           │   │
│  │                                                                 │   │
│  │  対応日 *      [2025-11-25] [10:30] ～ [11:00]                  │   │
│  │                                                                 │   │
│  │  商品          [SILPS           ▼] [ちゃんぷる～     ▼] [___▼]  │   │
│  │                                                                 │   │
│  │  作業担当 *    [山田太郎         ▼]                             │   │
│  │                                                                 │   │
│  │  対応区分      [問い合わせ       ▼]                             │   │
│  │                                                                 │   │
│  │  対応内容:                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │ □操作説明  □データ更新  □データ調査  □打合せ            │   │   │
│  │  │ □プログラム修正  □プログラム更新  □プログラム確認       │   │   │
│  │  │ □運用確認  □その他  □休日対応  □プログラム納品         │   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │                                                                 │   │
│  │  サポート報告 *    [定型文]                                     │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │                                                         │   │   │
│  │  │  （報告内容入力エリア）                                  │   │   │
│  │  │                                                         │   │   │
│  │  │                                                         │   │   │
│  │  │                                                         │   │   │
│  │  │                                                         │   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │                                                                 │   │
│  │  引継担当      [選択してください  ▼]                           │   │
│  │                                                                 │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  更新日時: 2025/11/25 10:35                  [保存]  [削除]     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**レイアウト仕様**:
- **モーダル幅**: 800px
- **モーダル最大高さ**: 90vh（スクロール対応）
- **オーバーレイ**: rgba(0, 0, 0, 0.5)

### 2.2 Tablet版レイアウト（768px〜1024px）

```
┌────────────────────────────────────────────┐
│           【オーバーレイ】                  │
│  ┌──────────────────────────────────────┐  │
│  │ サポート報告書入力             [×]    │  │
│  ├──────────────────────────────────────┤  │
│  │                                      │  │
│  │ 顧客コード * [____] [検索]           │  │
│  │ 顧客名: 株式会社○○○○              │  │
│  │                                      │  │
│  │ 部門 * [LPG支援部    ▼]             │  │
│  │                                      │  │
│  │ 顧客担当者名 [______________]        │  │
│  │                                      │  │
│  │ 対応日 *                             │  │
│  │ [2025-11-25] [10:30]～[11:00]       │  │
│  │                                      │  │
│  │ 商品                                 │  │
│  │ [SILPS    ▼] [ちゃんぷる▼]          │  │
│  │                                      │  │
│  │ 作業担当 * [山田太郎    ▼]          │  │
│  │                                      │  │
│  │ 対応区分 [問い合わせ   ▼]           │  │
│  │                                      │  │
│  │ 対応内容:                            │  │
│  │ □操作説明 □データ更新 □データ調査 │  │
│  │ □打合せ □プログラム修正 ...         │  │
│  │                                      │  │
│  │ サポート報告 *  [定型文]             │  │
│  │ ┌────────────────────────────────┐  │  │
│  │ │                                │  │  │
│  │ │                                │  │  │
│  │ │                                │  │  │
│  │ └────────────────────────────────┘  │  │
│  │                                      │  │
│  │ 引継担当 [選択してください▼]        │  │
│  │                                      │  │
│  ├──────────────────────────────────────┤  │
│  │              [保存] [削除]           │  │
│  └──────────────────────────────────────┘  │
└────────────────────────────────────────────┘
```

### 2.3 SP版レイアウト（767px以下）

```
┌──────────────────────────┐
│ サポート報告書入力  [×]  │
├──────────────────────────┤
│                          │
│ 顧客コード *             │
│ [________] [検索]        │
│ 顧客名: 株式会社○○     │
│                          │
│ 部門 *                   │
│ [LPG支援部          ▼]  │
│                          │
│ 顧客担当者名             │
│ [____________________]  │
│                          │
│ 対応日 *                 │
│ [2025-11-25]             │
│ [10:30] ～ [11:00]       │
│                          │
│ 商品1                    │
│ [SILPS              ▼]  │
│ 商品2                    │
│ [ちゃんぷる～       ▼]  │
│ 商品3                    │
│ [                   ▼]  │
│                          │
│ 作業担当 *               │
│ [山田太郎           ▼]  │
│                          │
│ 対応区分                 │
│ [問い合わせ         ▼]  │
│                          │
│ 対応内容:                │
│ □操作説明               │
│ □データ更新             │
│ □データ調査             │
│ ...                      │
│                          │
│ サポート報告 * [定型文]  │
│ ┌────────────────────┐  │
│ │                    │  │
│ │                    │  │
│ │                    │  │
│ │                    │  │
│ │                    │  │
│ └────────────────────┘  │
│                          │
│ 引継担当                 │
│ [選択してください   ▼]  │
│                          │
├──────────────────────────┤
│ [保存]                   │
│ [削除]                   │
└──────────────────────────┘
```

---

## 3. 項目定義

### 3.1 入力項目

| No | 項目名 | 項目ID | name属性 | 種類 | 必須 | 最大桁数 | デフォルト値 |
|----|-------|--------|---------|------|------|---------|------------|
| 1 | 顧客コード | kokyaku-code | kokyaku_code | 数値 | ○ | 10 | 空欄 |
| 2 | 顧客名 | kokyaku-name | - | 表示のみ | - | - | 空欄 |
| 3 | 部門 | bumon-code | bumon_code | セレクト | ○ | - | ログインユーザーの部門 |
| 4 | 顧客担当者名 | kokyaku-tanto | kokyaku_tanto | テキスト | - | 50 | 空欄 |
| 5 | 対応日（日付） | taiou-date | taiou_date | 日付 | ○ | - | 当日 |
| 6 | 対応開始時刻 | taiou-time-start | taiou_time_start | 時刻 | ○ | - | 現在時刻 |
| 7 | 対応終了時刻 | taiou-time-end | taiou_time_end | 時刻 | - | - | 開始時刻と同じ |
| 8 | 商品1 | shohin-code1 | shohin_code1 | セレクト | - | - | 空欄 |
| 9 | 商品2 | shohin-code2 | shohin_code2 | セレクト | - | - | 空欄 |
| 10 | 商品3 | shohin-code3 | shohin_code3 | セレクト | - | - | 空欄 |
| 11 | 作業担当 | tantou-code | tantou_code | セレクト | ○ | - | ログインユーザー |
| 12 | 対応区分 | kubun-code | kubun_code | セレクト | - | - | 空欄 |
| 13 | 対応内容1〜20 | taiou-flag-{n} | taiou_flag[] | チェック | - | - | OFF |
| 14 | 報告内容 | houkoku-naiyo | houkoku_naiyo | テキストエリア | ○ | MAX | 空欄 |
| 15 | 引継担当 | hikitsugi-code | hikitsugi_code | セレクト | - | - | 空欄 |

### 3.2 項目詳細

#### 3.2.1 顧客コード・顧客名
- **入力方法**: 直接入力または検索ボタンから選択
- **検索ボタン押下時**: 顧客検索ダイアログを表示
- **顧客名**: 顧客コード入力時に自動取得して表示（編集不可）
- **フォーカスアウト時**: Ajax で顧客名を取得

#### 3.2.2 部門
- **選択肢**: SQL_部門テーブルから取得
- **初期値**: ログインユーザーの所属部門
- **変更時**: 商品リスト、定型文リストを再取得

#### 3.2.3 対応日時
- **日付**: カレンダーピッカー使用
- **時刻**: HH:MM形式（5分単位推奨）
- **開始時刻初期値**: 現在時刻を5分単位に丸める
- **終了時刻**: 開始時刻以降であること

#### 3.2.4 商品（3件まで）
- **選択肢**: M_商品テーブルから取得（部門でフィルタ）
- **空欄許可**: 全て空欄可
- **重複不可**: 同じ商品を複数選択不可

#### 3.2.5 対応内容チェックボックス
- **項目数**: M_対応内容項目から動的取得（最大20項目）
- **表示**: 2列または3列でグリッド表示
- **複数選択可**: 何項目でもチェック可能

#### 3.2.6 報告内容
- **テキストエリア**: 複数行入力
- **行数**: 10行（PC）、8行（Tablet）、6行（SP）
- **定型文挿入**: カーソル位置または末尾に挿入

### 3.3 ボタン

| No | ボタン名 | ボタンID | 表示条件 | 処理内容 |
|----|---------|---------|---------|---------|
| 1 | 検索 | btn-kokyaku-search | 常時 | 顧客検索ダイアログを開く |
| 2 | 定型文 | btn-teikei | 常時 | 定型文選択ダイアログを開く |
| 3 | 保存 | btn-save | 常時 | バリデーション後に保存し一覧を更新、ダイアログを開いたまま新規入力状態へ戻す |
| 4 | 削除 | btn-delete | 編集モードのみ | データを削除 |
| 5 | × | btn-close | 常時 | ダイアログを閉じる（ヘッダー右上に配置） |

※ キャンセルボタンは廃止し、ヘッダーの「×」ボタンに統一

---

## 4. 処理フロー

### 4.1 新規登録モード（ダイアログ表示時）

```
START
  │
  ↓
┌─────────────────────┐
│初期値設定           │
│・部門=ログインユーザー部門│
│・対応日=当日        │
│・開始時刻=現在時刻  │
│・終了時刻=開始時刻  │
│・作業担当=ログインユーザー│
└────────┬────────────┘
         │
         ↓
┌─────────────────────┐
│マスタデータ取得      │
│・部門リスト         │
│・商品リスト         │
│・担当者リスト       │
│・対応区分リスト     │
│・対応内容項目リスト │
└────────┬────────────┘
         │
         ↓
┌─────────────────────┐
│ダイアログ表示        │
└─────────────────────┘
         │
        END
```

### 4.2 編集モード（ダイアログ表示時）

```
START
  │
  ↓
┌─────────────────────┐
│既存データ取得        │
│(SEL_D_作業報告_単一) │
└────────┬────────────┘
         │
    ┌────┴────┐
    │         │
  取得成功   取得失敗
    │         │
    ↓         ↓
┌─────────┐  エラー表示
│データを  │  ダイアログ閉じる
│フォームに│
│セット    │
└────┬────┘
     │
     ↓
┌─────────────────────┐
│マスタデータ取得      │
└────────┬────────────┘
         │
         ↓
┌─────────────────────┐
│ダイアログ表示        │
│（削除ボタン有効）    │
└─────────────────────┘
         │
        END
```

### 4.3 保存処理

```
START
  │
  ↓
┌─────────────────────┐
│クライアント側       │
│バリデーション       │
└────────┬────────────┘
         │
    ┌────┴────┐
    │         │
   OK        NG
    │         │
    ↓         ↓
  継続      エラー表示
            （処理終了）
    │
    ↓
┌─────────────────────┐
│フォームデータ収集    │
└────────┬────────────┘
         │
         ↓
┌─────────────────────┐
│Ajax POST送信         │
│(support_ajax02.php) │
└────────┬────────────┘
         │
         ↓
┌─────────────────────┐
│サーバー側           │
│バリデーション       │
└────────┬────────────┘
         │
    ┌────┴────┐
    │         │
   OK        NG
    │         │
    ↓         ↓
┌─────────┐  エラーJSON返却
│新規/更新 │  クライアントで表示
│判定      │
└────┬────┘
     │
┌────┴────┐
│         │
新規      更新
│         │
↓         ↓
SEQNO採番  SEQNO指定
(COUNTUP)  で更新
│         │
└────┬────┘
     │
     ↓
┌─────────────────────┐
│UPD_D_作業報告        │
│ストアドプロシージャ  │
└────────┬────────────┘
         │
    ┌────┴────┐
    │         │
  成功      失敗
    │         │
    ↓         ↓
成功JSON返却 エラーJSON返却
    │         │
    ↓         ↓
メッセージ表示 エラー表示
    │         │
    ↓         │
一覧再読込     │
    │         │
    ↓         │
入力内容リセット│
（現在日時+フラグ初期化）
    │
   END
```

### 4.4 削除処理

```
START
  │
  ↓
┌─────────────────────┐
│削除確認ダイアログ    │
│「本当に削除しますか？」│
└────────┬────────────┘
         │
    ┌────┴────┐
    │         │
   OK      キャンセル
    │         │
    ↓         ↓
  継続     処理終了
    │
    ↓
┌─────────────────────┐
│Ajax POST送信         │
│(support_ajax03.php) │
└────────┬────────────┘
         │
         ↓
┌─────────────────────┐
│DEL_D_作業報告        │
│(削除日時をセット)    │
└────────┬────────────┘
         │
    ┌────┴────┐
    │         │
  成功      失敗
    │         │
    ↓         ↓
ダイアログ閉じ エラー表示
一覧再読込    │
    │         │
   END       END
```

---

## 5. バリデーション

### 5.1 クライアント側バリデーション

| No | 項目 | チェック内容 | エラーメッセージ |
|----|------|-------------|-----------------|
| 1 | 顧客コード | 必須チェック | 顧客コードを入力してください。 |
| 2 | 顧客コード | 数値形式チェック | 顧客コードは数字で入力してください。 |
| 3 | 顧客コード | 存在チェック | 顧客が見つかりません。 |
| 4 | 部門 | 必須チェック | 部門を選択してください。 |
| 5 | 対応日（日付） | 必須チェック | 対応日を入力してください。 |
| 6 | 対応日（日付） | 日付形式チェック | 正しい日付を入力してください。 |
| 7 | 対応開始時刻 | 必須チェック | 開始時刻を入力してください。 |
| 8 | 対応終了時刻 | 開始≦終了チェック | 終了時刻は開始時刻以降を指定してください。 |
| 9 | 作業担当 | 必須チェック | 作業担当を選択してください。 |
| 10 | 報告内容 | 必須チェック | 報告内容を入力してください。 |
| 11 | 商品 | 重複チェック | 同じ商品が複数選択されています。 |

### 5.2 サーバー側バリデーション

クライアント側と同様のチェックに加え：

| No | 項目 | チェック内容 | エラーメッセージ |
|----|------|-------------|-----------------|
| 12 | 顧客コード | DB存在チェック | 顧客コードが存在しません。 |
| 13 | 部門 | DB存在チェック | 部門コードが存在しません。 |
| 14 | 商品 | DB存在チェック | 商品コードが存在しません。 |
| 15 | 作業担当 | DB存在チェック | 担当者コードが存在しません。 |
| 16 | 対応区分 | DB存在チェック | 対応区分コードが存在しません。 |

---

## 6. データベース連携

### 6.1 使用ストアドプロシージャ

| SP名 | 用途 | パラメータ |
|------|------|-----------|
| SEL_D_作業報告_単一 | 編集用データ取得 | SEQNO |
| UPD_D_作業報告 | 登録・更新 | 全カラム |
| DEL_D_作業報告 | 論理削除 | SEQNO |
| COUNTUP_SYS_SEQNO | SEQNO採番 | なし |
| SEL_SQL_顧客_単一 | 顧客情報取得 | 顧客コード |

### 6.2 保存処理パラメータ

```sql
EXEC UPD_D_作業報告
    @SEQNO = @seqno,                    -- 新規時は採番済み値
    @対応開始日時 = @taiou_start,
    @対応終了日時 = @taiou_end,
    @顧客コード = @kokyaku_code,
    @顧客担当者名 = @kokyaku_tanto,
    @部門コード = @bumon_code,
    @商品コード1 = @shohin_code1,
    @商品コード2 = @shohin_code2,
    @商品コード3 = @shohin_code3,
    @作業担当コード = @tantou_code,
    @対応区分コード = @kubun_code,
    @引継担当コード = @hikitsugi_code,
    @報告内容 = @houkoku_naiyo,
    @対応内容フラグ1 = @flag1,
    @対応内容フラグ2 = @flag2,
    -- ... @対応内容フラグ1〜20
    @更新日時 = GETDATE(),
    @入力マシン = @machine_name
```

---

## 7. Ajax通信

### 7.1 顧客情報取得（support_ajax_kokyaku.php）

**リクエスト**:

| パラメータ名 | 型 | 説明 |
|-------------|-----|------|
| action | string | 'get_kokyaku' |
| kokyaku_code | int | 顧客コード |

**レスポンス**:

```json
{
    "status": "success",
    "data": {
        "kokyaku_code": 12345,
        "kokyaku_name": "株式会社○○○○",
        "address": "東京都..."
    }
}
```

### 7.2 データ保存（support_ajax02.php）

**リクエスト**:

| パラメータ名 | 型 | 説明 |
|-------------|-----|------|
| action | string | 'save' |
| mode | string | 'new' or 'edit' |
| seqno | int | 編集時のみ必須 |
| kokyaku_code | int | 顧客コード |
| bumon_code | int | 部門コード |
| kokyaku_tanto | string | 顧客担当者名 |
| taiou_date | string | 対応日 |
| taiou_time_start | string | 開始時刻 |
| taiou_time_end | string | 終了時刻 |
| shohin_code1 | int | 商品コード1 |
| shohin_code2 | int | 商品コード2 |
| shohin_code3 | int | 商品コード3 |
| tantou_code | int | 作業担当コード |
| kubun_code | int | 対応区分コード |
| taiou_flag[] | array | 対応内容フラグ配列 |
| houkoku_naiyo | string | 報告内容 |
| hikitsugi_code | int | 引継担当コード |

**レスポンス（成功）**:

```json
{
    "status": "success",
    "message": "保存しました。",
    "seqno": 12345
}
```

**レスポンス（エラー）**:

```json
{
    "status": "error",
    "message": "保存に失敗しました。",
    "errors": [
        "顧客コードを入力してください。",
        "報告内容を入力してください。"
    ]
}
```

### 7.3 データ削除（support_ajax03.php）

**リクエスト**:

| パラメータ名 | 型 | 説明 |
|-------------|-----|------|
| action | string | 'delete' |
| seqno | int | 削除対象SEQNO |

**レスポンス**:

```json
{
    "status": "success",
    "message": "削除しました。"
}
```

---

## 8. エラーハンドリング

### 8.1 エラー表示位置

モーダルダイアログの本体上部にエラーボックスを表示

```
┌─────────────────────────────────────┐
│ サポート報告書入力             [×]  │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │【エラー】顧客コードを入力して  │ │
│ │ください。                      │ │
│ │【エラー】報告内容を入力して    │ │
│ │ください。                      │ │
│ └─────────────────────────────────┘ │
│                                     │
│  顧客コード * [     ] [検索]        │
│  ...                                │
└─────────────────────────────────────┘
```

### 8.2 項目別エラー表示

エラーがある項目は入力欄を赤枠で囲み、項目下にエラーメッセージを表示

```css
.input-error {
    border-color: #dc3545;
}
.error-text {
    color: #dc3545;
    font-size: 12px;
    margin-top: 5px;
}
```

---

## 9. 画面遷移

### 9.1 遷移先（ダイアログ内）

| 遷移トリガー | 遷移先 | 遷移方法 |
|-------------|--------|---------|
| 検索ボタン | 顧客検索ダイアログ | サブモーダル表示 |
| 定型文ボタン | 定型文選択ダイアログ | サブモーダル表示 |

### 9.2 ダイアログクローズ

| トリガー | 動作 |
|---------|------|
| ×ボタン（ヘッダー右上） | 変更確認後、閉じる |
| オーバーレイクリック | 変更確認後、閉じる |
| Escキー | 変更確認後、閉じる |
| 保存成功 | ダイアログを閉じずに一覧更新し、入力値を初期化 |
| 削除成功 | 即座に閉じる、一覧更新 |

※ キャンセルボタンは廃止

### 9.3 変更確認

フォーム内容に変更があり、保存せずに閉じようとした場合：

```
「変更内容が保存されていません。閉じてもよろしいですか？」
[OK] [キャンセル]
```

---

## 10. JavaScript処理

### 10.1 モーダル制御

```javascript
// モーダルを開く（新規）
function openInputDialog() {
    initNewMode();
    $('#input-modal').fadeIn(300);
    $('body').addClass('modal-open');
}

// モーダルを開く（編集）
function openInputDialogEdit(seqno) {
    loadEditData(seqno, function() {
        $('#input-modal').fadeIn(300);
        $('body').addClass('modal-open');
    });
}

// モーダルを閉じる
function closeInputDialog() {
    if (isFormChanged() && !confirm('変更内容が保存されていません。閉じてもよろしいですか？')) {
        return;
    }
    $('#input-modal').fadeOut(300);
    $('body').removeClass('modal-open');
    resetForm();
}
```

### 10.2 顧客コード入力時の自動取得

```javascript
$('#kokyaku-code').on('blur', function() {
    var code = $(this).val();
    if (code === '') {
        $('#kokyaku-name').text('');
        return;
    }
    
    $.ajax({
        type: 'POST',
        url: 'support_ajax_kokyaku.php',
        data: { action: 'get_kokyaku', kokyaku_code: code },
        dataType: 'json',
        success: function(response) {
            if (response.status === 'success') {
                $('#kokyaku-name').text(response.data.kokyaku_name);
            } else {
                $('#kokyaku-name').text('');
                showFieldError('#kokyaku-code', '顧客が見つかりません。');
            }
        }
    });
});
```

### 10.3 保存処理

```javascript
$('#btn-save').on('click', function() {
    // クライアント側バリデーション
    if (!validateForm()) {
        return;
    }
    
    var formData = collectFormData();
    
    showLoading();
    
    $.ajax({
        type: 'POST',
        url: 'support_ajax02.php',
        data: formData,
        dataType: 'json',
        success: function(response) {
            hideLoading();
            if (response.status === 'success') {
                showMessage(response.message);
                refreshList();
                resetFormForNewEntry();
            } else {
                showErrors(response.errors);
            }
        },
        error: function() {
            hideLoading();
            showError('通信エラーが発生しました。');
        }
    });
});

function resetFormForNewEntry() {
    // 保存完了後、ダイアログを閉じずに新規入力モードへ戻す
    clearValidationStates();
    $('#input-form')[0].reset();
    $('#taiou-date').val(getToday());
    $('#taiou-time-start').val(getNowRounded());
    $('#taiou-time-end').val(getNowRounded());
    $('input[name="taiou_flag[]"]').prop('checked', false);
    $('#houkoku-naiyo').val('');
    setNewSeqNoPlaceholder();
    $('#kokyaku-code').focus();
}

function clearValidationStates() {
    $('.error-text').remove();
    $('.input-error').removeClass('input-error');
}

function getToday() {
    return dayjs().format('YYYY-MM-DD');
}

function getNowRounded() {
    return dayjs().startOf('minute').minute(Math.floor(dayjs().minute() / 5) * 5).format('HH:mm');
}

function setNewSeqNoPlaceholder() {
    $('#seqno-display').text('新規');
    $('#hidden-seqno').val('');
}
```

---

## 11. CSS設計

### 11.1 モーダル基本スタイル

```css
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
}

.modal-content {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 800px;
    max-width: 95%;
    max-height: 90vh;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    z-index: 1001;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background-color: #007bff;
    color: #fff;
}

.modal-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
}

.modal-footer {
    padding: 15px 20px;
    background-color: #f5f5f5;
    border-top: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
```

### 11.2 フォームスタイル

```css
.form-row {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.form-row label {
    width: 120px;
    font-weight: bold;
    flex-shrink: 0;
}

.form-row .required {
    color: #dc3545;
}

.form-row .input-area {
    flex: 1;
}

.checkbox-group {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    padding: 10px;
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    width: auto;
    font-weight: normal;
}

.checkbox-group input[type="checkbox"] {
    margin-right: 5px;
}
```

---

## 12. 備考

### 12.1 既存システムとの違い

| 項目 | Accessシステム | WEBシステム |
|------|--------------|------------|
| 表示形式 | 別ウィンドウ | モーダルダイアログ |
| 保存方法 | 即時保存 | 保存ボタン押下時 |
| 顧客検索 | 別フォーム | サブモーダル |
| 定型文挿入 | 別フォーム | サブモーダル |
| バリデーション | VBA | JavaScript + PHP |

### 12.2 対応内容フラグの保存形式

- DB上は対応内容フラグ1〜20の20カラムで個別保存（0/1）
- 画面ではチェックボックスで表現
- 保存時は配列から各フラグに展開

### 12.3 テスト観点

- 新規登録：全必須項目入力、保存成功
- 編集：既存データ表示、変更保存
- 削除：確認ダイアログ、削除成功
- バリデーション：各エラーパターン
- 顧客検索：検索・選択・反映
- 定型文：選択・挿入
- 変更確認：変更後の閉じる確認
- レスポンシブ：各デバイスでのレイアウト

---

**作成者**: Claude AI  
**レビュー**: Phase 03完了時  
**改訂履歴**:
- v1.0 (2025-11-25): 初版作成
- v1.1 (2025-12-17): ダイアログ共通仕様変更
  - キャンセルボタンを廃止し、ヘッダーの「×」ボタンに統一
