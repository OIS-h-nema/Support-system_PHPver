# サポート報告書WEBシステム 全体設計書

**作成日**: 2025-11-25  
**バージョン**: 1.0  
**Phase**: 03

---

## 1. システム概要

### 1.1 システム名
サポート報告書WEBシステム

### 1.2 システムの目的
社員が日々の顧客からの問い合わせや対応内容を入力・記録・分析するためのWEBシステム。
既存のMS Accessシステムをリプレースし、WEBブラウザから利用可能にする。

### 1.3 システム構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          クライアント層                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │
│  │    PC      │  │  Tablet    │  │    SP      │                      │
│  │  (Chrome)  │  │  (iPad)    │  │ (iPhone)   │                      │
│  └─────────────┘  └─────────────┘  └─────────────┘                     │
│         │                │                │                            │
│         └────────────────┼────────────────┘                            │
│                          │                                              │
│                     HTTP/HTTPS                                          │
└────────────────────────────│────────────────────────────────────────────┘
                             │
┌────────────────────────────│────────────────────────────────────────────┐
│                          │                                              │
│  ┌───────────────────────┴───────────────────────┐                     │
│  │              WEBサーバー (IIS)                 │                     │
│  │              Windows Server                   │                     │
│  │  ┌─────────────────────────────────────────┐  │                     │
│  │  │              PHP 7.4                    │  │                     │
│  │  │  ┌────────────┐  ┌────────────────────┐ │  │                     │
│  │  │  │   共通    │  │   サポート報告書    │ │  │                     │
│  │  │  │  モジュール │  │   モジュール       │ │  │                     │
│  │  │  └────────────┘  └────────────────────┘ │  │                     │
│  │  │  ┌────────────┐  ┌────────────────────┐ │  │                     │
│  │  │  │  認証    │  │   マスタ保守       │ │  │                     │
│  │  │  │ モジュール │  │   モジュール       │ │  │                     │
│  │  │  └────────────┘  └────────────────────┘ │  │                     │
│  │  └─────────────────────────────────────────┘  │                     │
│  └───────────────────────────────────────────────┘                     │
│                          │                                              │
│                         PDO                                             │
│                          │                                              │
│  ┌───────────────────────┴───────────────────────┐                     │
│  │            SQL Server 2022                     │                     │
│  │            SUPPORTDB                          │                     │
│  │  ┌─────────────────────────────────────────┐  │                     │
│  │  │  ストアドプロシージャ                    │  │                     │
│  │  │  SEL_*, UPD_*, DEL_*, COUNTUP_*         │  │                     │
│  │  └─────────────────────────────────────────┘  │                     │
│  └───────────────────────────────────────────────┘                     │
│                       サーバー層                                        │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 技術スタック

### 2.1 フロントエンド

| 項目 | 技術 | バージョン |
|------|------|-----------|
| マークアップ | HTML5 / XHTML 1.0 Transitional | - |
| スタイル | CSS3 | - |
| JavaScript | jQuery | 1.11.3 |
| レスポンシブ | 独自CSS（PC/Tablet/SP分離） | - |

### 2.2 バックエンド

| 項目 | 技術 | バージョン |
|------|------|-----------|
| 言語 | PHP | 7.4以上 |
| WEBサーバー | IIS | Windows Server |
| DB接続 | PDO（SQL Server Native Client） | - |

### 2.3 データベース

| 項目 | 技術 | バージョン |
|------|------|-----------|
| RDBMS | SQL Server | 2022 |
| データベース名 | SUPPORTDB | - |
| 文字コード | UTF-8 | - |

---

## 3. 画面構成

### 3.1 画面一覧

| No | 画面名 | 画面ID | ファイル名 | 権限 |
|----|-------|--------|-----------|------|
| 1 | ログイン画面 | login | login.php | 全員 |
| 2 | メイン画面 | main | support_main.php | 認証済み |
| 3 | 入力ダイアログ | input | support_input.php（モーダル） | 認証済み |
| 4 | 定型文選択ダイアログ | teikei | （サブモーダル） | 認証済み |
| 5 | 商品マスタ | master_product | master_product.php | 管理者 |
| 6 | 定型文マスタ | master_template | master_template.php | 管理者 |
| 7 | 対応区分マスタ | master_category | master_category.php | 管理者 |
| 8 | 対応内容項目マスタ | master_content | master_content.php | 管理者 |

### 3.2 画面遷移図

```
                    ┌───────────────┐
                    │  ログイン画面  │
                    └───────┬───────┘
                            │ 認証成功
                            ↓
┌───────────────────────────────────────────────────────────────────────┐
│                         メイン画面                                     │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐     │
│  │新規入力  │  │  商品  │  │対応区分 │  │対応内容 │  │ 定型文 │     │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘     │
│       │            │            │            │            │          │
│       │            │            │            │            │          │
│       ↓            ↓            ↓            ↓            ↓          │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐     │
│  │入力DLG │  │商品DLG │  │区分DLG │  │内容DLG │  │定型DLG │     │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘     │
│       │                                                               │
│       ↓                                                               │
│  ┌─────────┐                                                          │
│  │定型文DLG│                                                          │
│  └─────────┘                                                          │
└───────────────────────────────────────────────────────────────────────┘
                            │ ログアウト
                            ↓
                    ┌───────────────┐
                    │  ログイン画面  │
                    └───────────────┘
```

---

## 4. 機能構成

### 4.1 機能一覧

| No | 機能名 | 機能ID | 優先度 | 説明 |
|----|-------|--------|--------|------|
| 1 | ログイン | auth_login | A | ユーザー認証 |
| 2 | ログアウト | auth_logout | A | セッション終了 |
| 3 | 一覧表示 | list_display | A | サポート報告書一覧 |
| 4 | 検索 | search | A | 複合条件検索 |
| 5 | 新規登録 | crud_create | A | データ登録 |
| 6 | データ取得 | crud_read | A | 単一データ取得 |
| 7 | データ更新 | crud_update | A | データ編集 |
| 8 | データ削除 | crud_delete | A | 論理削除 |
| 9 | 定型文選択 | template_select | B | 定型文挿入 |
| 10 | 商品マスタ保守 | master_product | B | マスタCRUD |
| 11 | 定型文マスタ保守 | master_template | B | マスタCRUD |
| 12 | 対応区分マスタ保守 | master_category | B | マスタCRUD |
| 13 | 対応内容項目マスタ保守 | master_content | B | マスタCRUD |
| 14 | Excel出力 | excel_export | C | 検索結果出力 |

### 4.2 機能関連図

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           認証モジュール                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                 │
│  │   ログイン  │    │  ログアウト  │    │ セッション管理 │                │
│  └─────────────┘    └─────────────┘    └─────────────┘                 │
└─────────────────────────────────────────────────────────────────────────┘
                                │
                                ↓
┌─────────────────────────────────────────────────────────────────────────┐
│                      サポート報告書モジュール                            │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                 │
│  │  一覧表示   │←──→│    検索    │    │  ソート    │                 │
│  └─────────────┘    └─────────────┘    └─────────────┘                 │
│         │                                                               │
│         ↓                                                               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                 │
│  │  新規登録   │    │    編集    │    │    削除    │                 │
│  └─────────────┘    └─────────────┘    └─────────────┘                 │
│         │                │                                              │
│         └────────────────┘                                              │
│                ↓                                                        │
│  ┌─────────────┐    ┌─────────────┐                                    │
│  │  定型文選択  │    │  商品選択   │                                    │
│  └─────────────┘    └─────────────┘                                    │
└─────────────────────────────────────────────────────────────────────────┘
                                │
                                ↓
┌─────────────────────────────────────────────────────────────────────────┐
│                        マスタ保守モジュール                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │
│  │  商品マスタ │  │ 定型文マスタ │  │対応区分マスタ│  │対応内容マスタ│  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. データベース構成

### 5.1 テーブル一覧

| No | テーブル名 | 種別 | 説明 |
|----|-----------|------|------|
| 1 | D_作業報告 | データ | サポート報告書データ |
| 2 | M_商品 | マスタ | 商品マスタ |
| 3 | M_定型文 | マスタ | 定型文マスタ |
| 4 | M_対応区分 | マスタ | 対応区分マスタ |
| 5 | M_対応内容項目 | マスタ | 対応内容項目マスタ |
| 6 | SQL_作業担当 | マスタ | 担当者マスタ（ビュー） |
| 7 | SQL_部門 | マスタ | 部門マスタ（ビュー） |
| 8 | SQL_顧客 | マスタ | 顧客マスタ（ビュー） |
| 9 | SYS_SEQNO | システム | SEQNO採番用 |
| 10 | DELDATA_商品 | 削除 | 削除商品格納 |
| 11 | DELDATA_定型文 | 削除 | 削除定型文格納 |
| 12 | DELDATA_対応区分 | 削除 | 削除対応区分格納 |
| 13 | DELDATA_対応内容項目 | 削除 | 削除対応内容項目格納 |

### 5.2 ER図（概要）

```
┌─────────────────┐
│   SQL_顧客      │
│  ・顧客コード(PK)│
│  ・顧客名        │
└────────┬────────┘
         │
         │1:N
         ↓
┌─────────────────┐      ┌─────────────────┐
│   D_作業報告    │      │   SQL_作業担当  │
│  ・SEQNO(PK)    │←───→│  ・担当者コード(PK)│
│  ・顧客コード(FK)│  N:1  │  ・作業担当名    │
│  ・作業担当コード│      │  ・部門コード    │
│  ・商品コード1-3│      └─────────────────┘
│  ・対応区分コード│
│  ・報告内容     │
│  ・対応内容フラグ1-20│
└────────┬────────┘
         │
    ┌────┼────────────────────┐
    │    │                    │
    ↓    ↓                    ↓
┌─────────┐  ┌─────────┐  ┌─────────┐
│ M_商品  │  │M_対応区分│  │M_対応内容項目│
└─────────┘  └─────────┘  └─────────┘
```

---

## 6. セキュリティ設計

### 6.1 認証・認可

| 項目 | 仕様 |
|------|------|
| 認証方式 | ID/パスワード認証 |
| セッション管理 | PHP標準セッション |
| タイムアウト | 9時間（32400秒） |
| 権限レベル | 1:一般ユーザー、2:管理者 |

### 6.2 セキュリティ対策

| 対策 | 実装方法 |
|------|---------|
| XSS対策 | htmlspecialchars()でエスケープ |
| SQLインジェクション対策 | PDOプリペアドステートメント |
| セッション固定攻撃対策 | session_regenerate_id() |
| CSRF対策 | 社内限定のため省略 |

---

## 7. 非機能要件

### 7.1 性能要件

| 項目 | 目標値 |
|------|--------|
| 画面表示 | 3秒以内 |
| 検索処理 | 2秒以内 |
| 保存処理 | 1秒以内 |
| 同時接続数 | 20ユーザー |

### 7.2 可用性要件

| 項目 | 目標値 |
|------|--------|
| 稼働時間 | 平日 8:00〜20:00 |
| 計画停止 | 月1回程度（夜間） |
| 障害復旧 | 翌営業日内 |

### 7.3 運用要件

| 項目 | 仕様 |
|------|------|
| バックアップ | 日次（SQL Server） |
| ログ | PHPエラーログ |
| 監視 | なし（社内システム） |

---

## 8. デプロイメント構成

### 8.1 環境構成

| 環境 | サーバー | パス |
|------|---------|------|
| 検証環境 | LPG-NEMA | \\LPG-NEMA\C\inetpub\wwwroot\support-system\ |
| 本番環境 | DEV-SE | \\DEV-SE\C\inetpub\wwwroot\support-system\ |

### 8.2 ディレクトリ構成

```
support-system/
├── login.php               # ログイン画面
├── logout.php              # ログアウト処理
├── support_main.php        # メイン画面
├── support_ajax01.php      # 検索Ajax
├── support_ajax02.php      # CRUD Ajax
├── support_ajax03.php      # 削除Ajax
├── support_ajax_master.php # マスタ取得Ajax
├── master_product.php      # 商品マスタ画面
├── master_template.php     # 定型文マスタ画面
├── master_category.php     # 対応区分マスタ画面
├── master_content.php      # 対応内容項目マスタ画面
├── master_ajax.php         # マスタCRUD Ajax
├── css/
│   ├── common.css          # 共通CSS
│   ├── pc.css              # PC用CSS
│   ├── tablet.css          # タブレット用CSS
│   └── sp.css              # SP用CSS
├── js/
│   ├── jquery-1.11.3.min.js
│   ├── common.js           # 共通JavaScript
│   └── support.js          # サポート報告書用JS
├── images/
│   └── (画像ファイル)
└── includes/
    ├── config.php          # 設定ファイル
    ├── auth.php            # 認証モジュール
    └── functions.php       # 独自関数
```

---

## 9. 外部連携

### 9.1 共通関数（既存）

| ファイル | 説明 |
|---------|------|
| C:\inetpub\func\inc.php | DB接続、セッション設定 |
| C:\inetpub\func\myFunction.php | 共通関数 |
| C:\inetpub\func\myConvert.php | 文字コード変換 |

### 9.2 外部システム連携

| システム | 連携方法 | 説明 |
|---------|---------|------|
| SQL Server | PDO | データベース接続 |
| Excel | PhpSpreadsheet | 出力機能（Phase 2以降） |

---

## 10. 制約事項

### 10.1 技術的制約

- PHP 7.4以上必須
- SQL Server 2022必須
- IIS（Windows Server）環境
- jQuery 1.11系を使用

### 10.2 運用上の制約

- 社内ネットワーク限定
- 同時編集による競合は楽観的ロック
- セッションタイムアウト9時間

---

## 11. 今後の拡張計画

| フェーズ | 内容 |
|---------|------|
| Phase 1 | 基本機能（ログイン、一覧、CRUD、マスタ） |
| Phase 2 | Excel出力機能 |
| Phase 3 | 集計・分析機能 |
| Phase 4 | 外部公開対応（セキュリティ強化） |

---

**作成者**: Claude AI  
**レビュー**: Phase 03完了時  
**改訂履歴**:
- v1.0 (2025-11-25): 初版作成
