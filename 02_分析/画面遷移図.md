# 画面遷移図

**作成日**: 2025-11-20  
**バージョン**: 1.0  
**Phase**: 02

---

## 1. 全体画面遷移図

```
┌─────────────────────────────────────────────────────────────────┐
│                         画面遷移フロー                            │
└─────────────────────────────────────────────────────────────────┘

         ┌─────────────────┐
         │  ログイン画面     │ (login.php)
         │  [LoginBox]      │
         └────────┬─────────┘
                  │ ログイン成功
                  │ セッション開始
                  ↓
         ┌─────────────────────────────────┐
         │  メイン画面（一覧）               │ (support_main.php)
         │  [サポート報告書 一覧]            │
         └────┬──────┬──────┬──────┬──────┘
              │      │      │      │
    ┌─────────┼──────┼──────┼──────┼─────────┐
    │         │      │      │      │         │
    ↓         ↓      ↓      ↓      ↓         ↓
[新規入力] [詳細/  [商品]  [対応  [対応   [定型文]
           修正]           区分]  内容]
    │         │      │      │      │         │
    ↓         ↓      ↓      ↓      ↓         ↓
┌───────┐ ┌───────┐ ┌────────┐ ┌────────┐ ┌────────┐
│入力    │ │入力    │ │マスタ設定│ │マスタ設定│ │マスタ設定│
│ダイアログ│ │ダイアログ│ │_商品    │ │_対応区分 │ │_定型文  │
│(新規)  │ │(編集)  │ │        │ │        │ │        │
└───┬───┘ └───┬───┘ └────┬───┘ └────┬───┘ └────┬───┘
    │         │          │          │          │
    │    ┌────┴────┐     │          │          │
    │    │ [定型文]  │     │          │          │
    │    ↓          │     │          │          │
    │  ┌────────────┐  │          │          │
    │  │定型文選択   │  │          │          │
    │  │ダイアログ   │  │          │          │
    │  └────┬───────┘  │          │          │
    │       │挿入      │          │          │
    │       ↓          │          │          │
    └───────┴──────────┴──────────┴──────────┘
            │
            ↓ [保存/閉じる]
    ┌─────────────────┐
    │  メイン画面に戻る  │
    └─────────────────┘
```

---

## 2. 詳細遷移フロー

### 2.1 ログインフロー

```
     START
       │
       ↓
┌─────────────┐
│ログイン画面  │
│表示         │
└──────┬──────┘
       │
       ↓
┌─────────────┐      NO    ┌──────────────┐
│ユーザーコード├───────────→│エラーメッセージ│
│パスワード入力│              └───────┬──────┘
└──────┬──────┘                     │
       │ YES                        │
       ↓                            │
┌─────────────┐                     │
│認証処理     │                     │
│(SQL_作業担当)│                     │
└──────┬──────┘                     │
       │                            │
    ┌──┴───┐                       │
    │      │                       │
   YES     NO ←─────────────────────┘
    │      │
    ↓      ↓
┌────────┐ ┌──────────┐
│セッション│ │ログイン画面│
│開始     │ │クリア     │
└────┬───┘ └──────────┘
     │
     ↓
┌─────────┐
│メイン画面│
│遷移     │
└─────────┘
     │
    END
```

---

### 2.2 メイン画面操作フロー

```
┌────────────────┐
│メイン画面表示   │
│（初期表示：     │
│  全件取得）     │
└────────┬───────┘
         │
    ┌────┴────┐
    │         │
    ↓         ↓
[検索実行]  [操作選択]
    │         │
    │    ┌────┴────┬────┬────┬────┬────┐
    │    │         │    │    │    │    │
    │   [入力]  [詳細] [商品][対応][対応][定型]
    │    │      /修正  │    区分  内容  文
    │    │      │    │    │    │    │
    │    ↓      ↓    ↓    ↓    ↓    ↓
    │  入力    入力  商品  対応  対応  定型文
    │  ダイアログ ダイアログ マスタ マスタ マスタ マスタ
    │  (新規)   (編集)
    │    │      │
    │    └───┬──┘
    │        │
    ↓        ↓
┌────────────┐
│一覧再表示   │
└────────────┘
```

---

### 2.3 入力ダイアログ操作フロー（新規登録）

```
     START
       │
       ↓
┌──────────────┐
│入力ダイアログ │
│表示（新規）   │
│・初期値設定  │
└───────┬──────┘
        │
   ┌────┴────┬────────┐
   │         │        │
[顧客検索] [定型文] [保存]
   │         │        │
   ↓         ↓        │
顧客検索   定型文選択   │
ダイアログ  ダイアログ   │
   │         │        │
[選択]    [挿入]      │
   │         │        │
   └────┬────┘        │
        │            │
        ↓            ↓
    ┌────────────┐  ┌─────────┐
    │項目に反映   │  │バリデーション│
    └────────────┘  └──────┬──┘
                          │
                      ┌───┴───┐
                      │       │
                     OK      NG
                      │       │
                      ↓       ↓
              ┌──────────┐ ┌────────┐
              │DB保存     │ │エラー表示│
              │(UPD_D_   │ └────────┘
              │作業報告)  │
              └──────┬───┘
                     │
                     ↓
              ┌──────────┐
              │ダイアログ │
              │閉じる    │
              └──────┬───┘
                     │
                     ↓
              ┌──────────┐
              │メイン画面 │
              │一覧更新  │
              └──────────┘
                     │
                    END
```

---

### 2.4 入力ダイアログ操作フロー（編集）

```
     START
       │
       ↓
┌──────────────┐
│入力ダイアログ │
│表示（編集）   │
│・既存データ  │
│  読み込み    │
└───────┬──────┘
        │
   ┌────┴────┬────────┬────────┐
   │         │        │        │
[顧客検索] [定型文] [保存]  [削除]
   │         │        │        │
   ↓         ↓        │        ↓
（新規と同様）          │    ┌──────────┐
                      │    │削除確認   │
                      │    │ダイアログ │
                      │    └──────┬───┘
                      │           │
                      │       ┌───┴───┐
                      │       │       │
                      │      OK      CANCEL
                      │       │       │
                      ↓       ↓       ↓
              ┌──────────┐ ┌─────────┐ キャンセル
              │バリデーション│ │DB削除    │
              └──────┬───┘ │(DEL_D_  │
                     │      │作業報告) │
                 ┌───┴───┐ └─────┬───┘
                 │       │       │
                OK      NG       │
                 │       │       │
                 ↓       ↓       │
          ┌──────────┐ エラー   │
          │DB更新     │         │
          │(UPD_D_   │         │
          │作業報告)  │         │
          └──────┬───┘         │
                 │              │
                 └──────┬───────┘
                        │
                        ↓
                  ┌──────────┐
                  │ダイアログ │
                  │閉じる    │
                  └──────┬───┘
                        │
                        ↓
                  ┌──────────┐
                  │メイン画面 │
                  │一覧更新  │
                  └──────────┘
                        │
                       END
```

---

### 2.5 マスタ設定画面共通フロー

```
     START
       │
       ↓
┌──────────────┐
│マスタ設定画面 │
│表示          │
│・一覧取得    │
└───────┬──────┘
        │
   ┌────┴────┬────────┬────────┐
   │         │        │        │
[新規入力] [修正]  [削除]  [閉じる]
   │         │        │        │
   ↓         ↓        ↓        ↓
入力欄に   一覧から  削除確認   画面を
新規入力   選択して            閉じる
           入力欄に            メイン画面
           セット              に戻る
   │         │        │
   │         │        ↓
   │         │    ┌──────────┐
   │         │    │確認ダイアログ│
   │         │    └──────┬───┘
   │         │           │
   │         │       ┌───┴───┐
   │         │       │       │
   │         │      OK      CANCEL
   │         │       │       │
   │         │       ↓       ↓
   └────┬────┘   ┌──────┐  キャンセル
        │          │DB削除 │
        ↓          │(DEL_*) │
   ┌─────────┐   └───┬──┘
   │バリデーション│      │
   └──────┬──┘       │
          │          │
      ┌───┴───┐      │
      │       │      │
     OK      NG      │
      │       │      │
      ↓       ↓      │
  ┌────────┐ エラー  │
  │DB保存   │        │
  │(UPD_M_*)│        │
  └────┬───┘        │
       │            │
       └─────┬──────┘
             │
             ↓
        ┌─────────┐
        │一覧再表示 │
        └─────────┘
             │
            END
```

---

## 3. セッション管理フロー

```
┌──────────────────┐
│ログイン成功       │
└────────┬─────────┘
         │
         ↓
┌──────────────────┐
│セッション開始     │
│・セッションID生成 │
│・担当者情報格納   │
│・タイムアウト設定 │
│  （9時間）       │
└────────┬─────────┘
         │
    ┌────┴────┐
    │         │
通常操作   タイムアウト
    │         │
    │         ↓
    │    ┌──────────┐
    │    │セッション  │
    │    │破棄       │
    │    └──────┬───┘
    │           │
    ↓           ↓
[ログアウト] ログイン画面
    │        へ強制遷移
    ↓
┌──────────┐
│セッション破棄│
└──────┬───┘
       │
       ↓
┌──────────┐
│ログイン画面│
│へ遷移     │
└──────────┘
```

---

## 4. エラーハンドリングフロー

```
各処理中
    │
    ↓
┌─────────┐
│エラー発生？│
└─────┬───┘
      │
  ┌───┴───┐
  │       │
 YES      NO
  │       │
  ↓       ↓
┌──────┐ 処理継続
│エラー種類│
│判定    │
└───┬────┘
    │
┌───┴─────┬─────────┬──────────┐
│         │         │          │
バリデーション  DB     セッション  システム
エラー      エラー   エラー      エラー
│         │         │          │
↓         ↓         ↓          ↓
画面上に   エラー    ログイン    エラー画面
エラー表示  ログ記録  画面へ遷移  表示
入力継続   エラー画面             管理者通知
         表示
```

---

## 5. Ajax通信フロー

### 5.1 検索処理

```
メイン画面
    │
    ↓ [検索]ボタンクリック
┌──────────┐
│検索条件   │
│収集      │
└────┬─────┘
     │
     ↓ Ajax POST
┌──────────────┐
│サーバー側     │
│(support_ajax01.php)│
└────┬─────────┘
     │
     ↓ SQL実行
┌──────────┐
│検索結果   │
│取得      │
└────┬─────┘
     │
     ↓ JSON返却
┌──────────┐
│クライアント│
│受信      │
└────┬─────┘
     │
     ↓ DOM操作
┌──────────┐
│一覧テーブル│
│更新      │
└──────────┘
```

---

## 6. ファイル出力フロー

### 6.1 Excel出力

```
メイン画面
    │
    ↓ [EXCEL]ボタンクリック
┌──────────┐
│現在の検索│
│条件を取得 │
└────┬─────┘
     │
     ↓ POST送信
┌──────────────┐
│サーバー側     │
│(excel_export.php)│
└────┬─────────┘
     │
     ↓
┌──────────┐
│データ取得 │
│Excel生成  │
└────┬─────┘
     │
     ↓
┌──────────┐
│ファイル   │
│ダウンロード│
└──────────┘
```

---

## 7. 権限別画面遷移制限

### 7.1 一般ユーザー

```
メイン画面
├→ 入力ダイアログ（自分のデータのみ編集可）
├→ 定型文選択
└→ ログアウト

※マスタ設定画面へのアクセス不可
```

### 7.2 管理者

```
メイン画面
├→ 入力ダイアログ（すべてのデータ編集可）
├→ 定型文選択
├→ マスタ設定_商品
├→ マスタ設定_対応区分
├→ マスタ設定_対応内容項目
├→ マスタ設定_定型文
└→ ログアウト
```

---

## 8. モバイル対応時の遷移変更

### 8.1 スマートフォン

```
ログイン画面
    │
    ↓
メイン画面（簡易版）
├→ ハンバーガーメニュー
│  ├→ 新規入力
│  ├→ 検索
│  ├→ マスタ設定（管理者のみ）
│  └→ ログアウト
│
└→ 一覧（カード形式）
   └→ タップで詳細表示
      └→ 編集モードへ
```

---

## 9. Phase別実装範囲

### Phase 09-10
```
ログイン → メイン画面（一覧のみ）
```

### Phase 11
```
ログイン → メイン画面 ⇄ 入力ダイアログ（新規/編集）
```

### Phase 12以降
```
完全な画面遷移実装
├→ マスタ設定画面
├→ 定型文選択
├→ Excel出力
└→ その他の機能
```

---

**完了日**: 2025-11-20  
**レビュー**: Phase 02完了時に最終確認
