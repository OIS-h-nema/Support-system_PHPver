# サポート報告書WEBシステム 非機能要件定義書

**作成日**: 2025-11-21  
**バージョン**: 1.0  
**Phase**: 02

---

## 1. 概要

本書は、サポート報告書WEBシステムの非機能要件を定義するものです。
機能要件定義書と合わせて、システム全体の要件を明確にします。

---

## 2. 性能要件

### 2.1 レスポンスタイム

#### 2.1.1 画面表示
| 操作 | 目標レスポンスタイム | 備考 |
|------|---------------------|------|
| ログイン処理 | 2秒以内 | 認証処理含む |
| メイン画面表示（一覧） | 3秒以内 | 100件表示時 |
| 検索結果表示 | 3秒以内 | 検索条件による絞り込み |
| 詳細画面表示 | 1秒以内 | 1件のデータ取得 |
| 登録・更新処理 | 2秒以内 | DB書き込み含む |
| 削除処理 | 2秒以内 | DB削除処理含む |
| Ajax通信（定型文取得等） | 1秒以内 | 非同期通信 |

#### 2.1.2 性能目標の根拠
- 社内ネットワーク環境での利用を前提
- ギガビットイーサネット接続
- SQL Serverは同一ネットワーク内に配置
- ユーザーの待機ストレスを最小化

### 2.2 同時接続数

#### 2.2.1 想定ユーザー数
- **最大同時接続ユーザー数**: 20名
- **通常時の同時接続数**: 5-10名
- **ピーク時の同時接続数**: 15名程度

#### 2.2.2 対応方針
- PHP-FPMのプロセス数を適切に設定
- SQL Serverの接続プール設定を最適化
- セッション管理の効率化

### 2.3 データ量

#### 2.3.1 想定データ量
- **サポート報告書データ**: 年間約5,000件（1日約20件想定）
- **マスタデータ**: 
  - 商品マスタ: 約500件
  - 定型文マスタ: 約100件
  - 対応区分マスタ: 約20件
  - 対応内容項目マスタ: 20件（固定）
- **保存期間**: 過去5年分（約25,000件）

#### 2.3.2 データ増加への対応
- 定期的なアーカイブ処理（5年以上前のデータ）
- インデックスの最適化
- パーティショニングの検討（将来的に）

### 2.4 スループット

- **1時間あたりの処理件数**: 最大100件の新規登録
- **1日あたりの処理件数**: 最大500件の参照・更新

---

## 3. 可用性要件

### 3.1 稼働時間

#### 3.1.1 運用時間
- **平日**: 8:00 - 20:00（12時間）
- **土日祝**: 原則停止（メンテナンス時間）
- **システム稼働率目標**: 99.0%（営業時間内）

#### 3.1.2 計画停止
- **定期メンテナンス**: 毎週日曜日 0:00 - 6:00
- **緊急メンテナンス**: 必要に応じて実施（事前通知あり）

### 3.2 バックアップ方針

#### 3.2.1 データベースバックアップ
| 種類 | 頻度 | 保存期間 | 実施時刻 |
|------|------|---------|---------|
| フルバックアップ | 毎日 | 7日間 | 深夜2:00 |
| 差分バックアップ | 4時間ごと | 2日間 | 6:00, 10:00, 14:00, 18:00 |
| トランザクションログ | 1時間ごと | 1日間 | 毎時00分 |

#### 3.2.2 アプリケーションバックアップ
- **ソースコード**: Gitリポジトリで管理（将来的に）
- **設定ファイル**: 週次でバックアップ
- **ログファイル**: 月次でアーカイブ

### 3.3 障害時の対応

#### 3.3.1 目標復旧時間（RTO）
- **重大障害**: 4時間以内に復旧
- **軽微な障害**: 1営業日以内に復旧

#### 3.3.2 目標復旧時点（RPO）
- **データ損失許容**: 最大1時間分まで

#### 3.3.3 障害対応フロー
1. 障害検知（ユーザー報告またはシステム監視）
2. 一次対応（再起動、ログ確認）
3. 原因調査
4. 復旧作業
5. 動作確認
6. ユーザー通知
7. 事後報告書作成

### 3.4 冗長化

#### 3.4.1 現行構成
- **WEBサーバー**: 単一構成（冗長化なし）
- **DBサーバー**: SQL Server標準構成（冗長化なし）

#### 3.4.2 将来的な冗長化検討
- WEBサーバーの冗長化（ロードバランサー導入）
- DBサーバーのフェイルオーバー構成
- セッションの外部ストレージ化（Redis等）

---

## 4. 保守性要件

### 4.1 ログ出力方針

#### 4.1.1 アプリケーションログ
| ログ種別 | 出力内容 | 出力先 | 保存期間 |
|---------|---------|--------|---------|
| アクセスログ | URL、ユーザーID、日時 | logs/access.log | 3ヶ月 |
| エラーログ | エラー内容、スタックトレース | logs/error.log | 6ヶ月 |
| 操作ログ | CRUD操作、対象データ | logs/operation.log | 1年 |
| 認証ログ | ログイン・ログアウト | logs/auth.log | 1年 |

#### 4.1.2 ログフォーマット
```
[日時] [ログレベル] [ユーザーID] [処理名] メッセージ
例: [2025-11-21 10:30:45] [INFO] [USER001] [登録処理] サポート報告書を登録しました（ID: 12345）
```

#### 4.1.3 ログレベル
- **DEBUG**: 開発時のみ出力
- **INFO**: 正常な操作・処理
- **WARN**: 警告（処理は継続）
- **ERROR**: エラー（処理中断）
- **FATAL**: 致命的エラー（システム停止）

### 4.2 エラーハンドリング

#### 4.2.1 エラー分類
| エラー種別 | 対応方法 | ユーザー通知 |
|-----------|---------|-------------|
| 入力エラー | エラーメッセージ表示 | 具体的な修正方法を表示 |
| DB接続エラー | リトライ3回、失敗時はエラー画面 | 「システムエラーが発生しました」 |
| DB処理エラー | ロールバック、エラーログ出力 | 「データ処理に失敗しました」 |
| セッションタイムアウト | ログイン画面へリダイレクト | 「セッションが切れました」 |
| 権限エラー | エラーメッセージ表示 | 「権限がありません」 |
| システムエラー | エラーログ出力、管理者通知 | 「システムエラーが発生しました」 |

#### 4.2.2 エラー画面
- ユーザーフレンドリーなエラーメッセージ
- エラーコードの表示（サポート時の参照用）
- 前画面へ戻るリンク
- ホーム画面へ戻るリンク

### 4.3 システム監視

#### 4.3.1 監視項目
- **サーバー監視**
  - CPU使用率
  - メモリ使用率
  - ディスク使用率
  - ネットワーク通信量
- **アプリケーション監視**
  - プロセス稼働状況
  - エラーログ監視
  - レスポンスタイム
- **データベース監視**
  - SQL Server稼働状況
  - 接続数
  - スロークエリ
  - デッドロック発生

#### 4.3.2 監視方法
- IISログの定期確認
- SQL Serverログの定期確認
- 手動での定期確認（自動監視ツールは将来的に導入検討）

### 4.4 変更管理

#### 4.4.1 変更手順
1. 変更要求の受付
2. 影響範囲の調査
3. 変更計画の作成
4. テスト環境での検証
5. 本番環境への適用
6. 動作確認
7. 変更履歴の記録

#### 4.4.2 変更履歴管理
- ファイルヘッダーに更新履歴を記録
- 変更内容を `06_調整/修正履歴.md` に記録
- バージョン番号の更新

---

## 5. セキュリティ要件

### 5.1 認証・認可

#### 5.1.1 認証方式
- **認証方法**: ID・パスワード認証
- **認証情報の保存**: SQL ServerのM_担当者テーブル
- **パスワード**: 暗号化して保存（将来的にハッシュ化検討）
- **セッション管理**: PHP標準セッション（9時間タイムアウト）

#### 5.1.2 権限管理
- **現状**: 全ユーザー同一権限（管理者権限なし）
- **将来的な拡張**: 一般ユーザー・管理者の区分を検討

### 5.2 データ保護

#### 5.2.1 通信の暗号化
- **現状**: 社内ネットワーク限定のため非暗号化（HTTP）
- **将来的な対応**: 外部公開時はHTTPS化を検討

#### 5.2.2 データの暗号化
- **現状**: データベース内のデータは非暗号化
- **個人情報**: 顧客名、担当者名等は含まれるが、社内利用のため暗号化不要
- **将来的な対応**: 重要情報の暗号化を検討

### 5.3 アクセス制御

#### 5.3.1 ネットワークレベル
- **アクセス許可**: 社内ネットワークからのみ
- **外部アクセス**: 不可
- **ファイアウォール**: 社内ネットワークで管理

#### 5.3.2 アプリケーションレベル
- **ログイン認証**: 必須
- **セッション管理**: タイムアウト9時間
- **CSRF対策**: 社内ネットワーク限定のため省略
- **XSS対策**: 入力値のサニタイズ（htmlspecialchars）
- **SQLインジェクション対策**: プリペアドステートメント使用

### 5.4 セキュリティ対策一覧

| 脅威 | 対策 | 優先度 | 実装状況 |
|------|------|--------|---------|
| SQLインジェクション | プリペアドステートメント | 高 | 必須実装 |
| XSS | htmlspecialchars | 高 | 必須実装 |
| CSRF | トークン検証 | 低 | 省略（社内限定） |
| セッションハイジャック | セッションID再生成 | 中 | 実装推奨 |
| 不正ログイン | ログイン試行回数制限 | 低 | 将来的に検討 |
| 情報漏洩 | ログ出力制御 | 中 | 実装推奨 |

---

## 6. ユーザビリティ要件

### 6.1 対応ブラウザ

#### 6.1.1 サポート対象
| ブラウザ | バージョン | 備考 |
|---------|-----------|------|
| Google Chrome | 最新版 | 推奨ブラウザ |
| Microsoft Edge | 最新版 | 推奨ブラウザ |
| Firefox | 最新版 | サポート |
| Safari | 最新版 | サポート（Macユーザー向け） |

#### 6.1.2 非サポート
- Internet Explorer（全バージョン）
- 旧バージョンのブラウザ

### 6.2 レスポンシブ対応

#### 6.2.1 対応デバイス
| デバイス | 画面幅 | CSS | 主な用途 |
|---------|--------|-----|---------|
| PC | 1025px以上 | pc.css | 主要デバイス |
| タブレット | 768px～1024px | tablet.css | 外出先での入力 |
| スマートフォン | 767px以下 | sp.css | 参照用途 |

#### 6.2.2 レスポンシブ設計方針
- PC版を基準として設計
- タブレットは入力のしやすさを重視
- スマートフォンは参照・簡易入力を重視
- 各デバイスで操作性を最適化

### 6.3 アクセシビリティ

#### 6.3.1 基本方針
- 社内システムのため、WCAG等の厳密な準拠は不要
- ただし、基本的な使いやすさは確保

#### 6.3.2 実装事項
- **キーボード操作**: Tabキーでの移動、Enterキーでの決定
- **フォーカス表示**: 現在フォーカス中の項目を明示
- **エラーメッセージ**: 具体的で分かりやすい表現
- **ラベル**: 全ての入力項目にラベルを付与
- **コントラスト**: 文字と背景のコントラストを確保

### 6.4 操作性

#### 6.4.1 入力支援
- **日付入力**: カレンダーピッカーの使用
- **プルダウン選択**: マスタデータからの選択
- **定型文選択**: モーダルダイアログでの選択
- **商品選択**: 検索可能な選択ダイアログ
- **入力補完**: 過去の入力履歴からの候補表示（将来的に検討）

#### 6.4.2 確認機能
- **削除時の確認**: 必ず確認ダイアログを表示
- **更新時の確認**: データ変更時に変更内容を明示
- **重複登録防止**: 二重送信防止の実装

#### 6.4.3 フィードバック
- **処理中の表示**: ローディング表示（くるくる）
- **完了メッセージ**: 処理完了を明確に通知
- **エラー通知**: エラー内容を分かりやすく表示

---

## 7. 互換性要件

### 7.1 既存データとの互換性

#### 7.1.1 データベース互換性
- **SQL Server**: 既存のSQL Server 2022をそのまま使用
- **テーブル構造**: 既存のテーブル構造を維持
- **ストアドプロシージャ**: 既存のSPをそのまま使用

#### 7.1.2 データ移行
- AccessからWEBへの移行は「切り替え」のみ
- データ移行作業は不要（同一DB使用のため）
- Accessローカルテーブル（SQL_*）は使用停止

### 7.2 ブラウザ互換性

#### 7.2.1 HTML/CSS
- **HTML**: XHTML 1.0 Transitional
- **CSS**: CSS3（ベンダープレフィックス考慮）
- **JavaScript**: ES5互換（jQuery 1.11使用）

#### 7.2.2 互換性確保方法
- クロスブラウザテストの実施
- CSSリセットの適用
- ブラウザ固有の問題への対応

---

## 8. 拡張性要件

### 8.1 機能拡張

#### 8.1.1 想定される機能拡張
- **レポート機能**: 月次・年次集計レポート
- **グラフ表示**: データの可視化
- **エクスポート機能**: Excel・CSV出力
- **権限管理**: 一般ユーザー・管理者の区分
- **承認フロー**: 報告書の承認プロセス
- **メール通知**: 登録時の自動通知
- **API公開**: 外部システムとの連携

#### 8.1.2 拡張性確保方法
- モジュール化された設計
- 共通処理の関数化
- データベース設計の柔軟性
- 設定ファイルでの制御

### 8.2 スケーラビリティ

#### 8.2.1 現状の想定
- ユーザー数: 10-20名
- データ量: 年間5,000件
- 同時接続: 最大20名

#### 8.2.2 将来的な拡張
- ユーザー数: 50名程度まで対応可能
- データ量: 年間10,000件まで対応可能
- 同時接続: 50名程度まで対応可能

#### 8.2.3 スケーラビリティ確保方法
- データベースインデックスの最適化
- キャッシュ機構の導入（将来的に）
- 負荷分散の検討（将来的に）

---

## 9. 運用要件

### 9.1 運用体制

#### 9.1.1 体制
- **システム管理者**: 1名（社内IT担当者）
- **運用担当者**: 1名（システム管理者兼務）
- **ユーザーサポート**: システム管理者が対応

#### 9.1.2 連絡体制
- **障害連絡**: メール・電話
- **問い合わせ**: メール・対面
- **緊急連絡**: 電話（営業時間外は翌営業日対応）

### 9.2 運用手順

#### 9.2.1 日次運用
- システム稼働確認（朝）
- エラーログ確認（夕方）
- ディスク容量確認（夕方）

#### 9.2.2 週次運用
- バックアップ確認
- アクセスログ分析
- パフォーマンス確認

#### 9.2.3 月次運用
- ログファイルのアーカイブ
- システムパフォーマンスレポート作成
- ユーザーフィードバックの収集

### 9.3 保守作業

#### 9.3.1 定期保守
- **SQL Serverメンテナンス**: 月次
- **インデックス再構築**: 月次
- **統計情報更新**: 週次
- **ログファイルクリア**: 月次

#### 9.3.2 緊急保守
- 障害発生時の緊急対応
- セキュリティパッチ適用
- 緊急バグ修正

---

## 10. 開発・テスト要件

### 10.1 開発環境

#### 10.1.1 環境構成
- **開発PC**: Windows 10/11
- **WEBサーバー**: IIS（検証環境）
- **DBサーバー**: SQL Server 2022（検証環境）
- **エディタ**: Visual Studio Code等

### 10.2 テスト環境

#### 10.2.1 検証環境
- **場所**: `\\LPG-NEMA\C\inetpub\wwwroot\support-system\`
- **目的**: 開発したシステムの動作確認
- **アクセス**: 開発者・テスターのみ

#### 10.2.2 本番環境
- **場所**: `\\DEV-SE\C\inetpub\wwwroot\support-system\`
- **目的**: 本番稼働
- **アクセス**: 全ユーザー

### 10.3 テスト要件

#### 10.3.1 テストレベル
| テストレベル | 目的 | 実施者 |
|------------|------|-------|
| 単体テスト | 各機能の動作確認 | 開発者（AI） |
| 結合テスト | 画面遷移・データ連携確認 | 開発者（AI） |
| システムテスト | 全体の動作確認 | システム管理者 |
| 運用テスト | 実運用を想定した確認 | ユーザー |

#### 10.3.2 テスト項目
- 機能テスト（正常系・異常系）
- 画面表示テスト（PC/Tablet/SP）
- 性能テスト（レスポンスタイム）
- セキュリティテスト（XSS、SQLインジェクション）
- ブラウザ互換性テスト

---

## 11. 移行要件

### 11.1 移行方針

#### 11.1.1 基本方針
- AccessからWEBへの「切り替え」
- データベースは同一のため、データ移行不要
- Accessファイルは廃止（バックアップとして保管）

#### 11.1.2 移行スケジュール
1. WEBシステム完成・テスト完了
2. ユーザートレーニング実施
3. 本番環境への配置
4. 並行稼働期間（1週間程度）
5. 本番稼働開始
6. Access廃止

### 11.2 移行時の注意事項

- 並行稼働期間中のデータ整合性確保
- ユーザーへの操作方法の周知徹底
- 万が一の切り戻し手順の準備
- 移行後の問い合わせ対応体制の確保

---

## 12. ドキュメント要件

### 12.1 必須ドキュメント

| ドキュメント名 | 目的 | 対象者 |
|--------------|------|--------|
| 操作マニュアル | システムの使い方 | 全ユーザー |
| 管理者ガイド | システム管理方法 | システム管理者 |
| FAQ | よくある質問 | 全ユーザー |
| トラブルシューティングガイド | 障害対応方法 | システム管理者 |
| 開発規約書 | 開発ルール | 開発者 |
| 設計書 | システム設計 | 開発者・管理者 |

### 12.2 ドキュメント管理

- **形式**: Markdown形式
- **保存場所**: `08_ドキュメント/`
- **更新**: システム変更時に随時更新
- **バージョン管理**: ファイル内に更新履歴を記載

---

## 13. コスト要件

### 13.1 初期コスト

| 項目 | 内容 | 費用 |
|------|------|------|
| 開発コスト | AI開発のため実質ゼロ | ¥0 |
| ライセンス費用 | 既存のライセンスを使用 | ¥0 |
| ハードウェア | 既存サーバーを使用 | ¥0 |

### 13.2 運用コスト

| 項目 | 内容 | 費用（月額） |
|------|------|-------------|
| サーバー運用 | 既存サーバーで運用 | ¥0 |
| 保守費用 | 社内で対応 | ¥0 |
| ライセンス費用 | 既存ライセンス | ¥0 |

**総運用コスト**: 実質ゼロ円（人件費除く）

---

## 14. 制約事項

### 14.1 技術的制約

- **プラットフォーム**: Windows Server + IIS + PHP + SQL Server
- **ネットワーク**: 社内ネットワーク限定
- **データベース**: 既存のSQL Serverを使用（変更不可）
- **ストアドプロシージャ**: 既存のSPを使用（変更最小限）

### 14.2 運用上の制約

- **運用時間**: 平日8:00-20:00（土日祝は停止可）
- **サポート**: システム管理者1名のみ
- **予算**: 追加投資なし

### 14.3 開発上の制約

- **開発者**: Claude AIのみ
- **開発期間**: 特に制約なし（品質優先）
- **参考システム**: ois-webシステムの構造を踏襲

---

## 15. 優先度

### 15.1 非機能要件の優先度

| 要件カテゴリ | 優先度 | 理由 |
|------------|-------|------|
| 性能 | 高 | ユーザーの生産性に直結 |
| 可用性 | 中 | 営業時間内の稼働で十分 |
| 保守性 | 高 | 長期運用を見据えて必須 |
| セキュリティ | 中 | 社内限定のため最小限でOK |
| ユーザビリティ | 高 | ユーザーの使いやすさ最優先 |
| 互換性 | 高 | 既存データとの互換性必須 |
| 拡張性 | 中 | 将来的な拡張に備える |

---

## 16. まとめ

本システムは社内ネットワーク限定で運用されるため、外部公開システムと比較してセキュリティ要件は緩和されます。
一方で、日常業務で使用するシステムのため、性能・ユーザビリティ・保守性を重視した設計とします。

既存のSQL Serverデータベースとストアドプロシージャを活用することで、開発コストを抑えつつ、
安定した動作を実現します。

将来的な機能拡張も見据えた柔軟な設計とし、段階的なシステム成長を可能とします。

---

**作成者**: Claude AI  
**承認者**: （プロジェクト責任者）  
**承認日**: （承認日を記入）  

**改訂履歴**:
- v1.0 (2025-11-21): 初版作成（Phase 02）
