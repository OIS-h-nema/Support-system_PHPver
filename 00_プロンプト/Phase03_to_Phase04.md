# Phase 04 詳細設計 開始プロンプト

**作成日**: 2025-11-25  
**前Phase**: Phase 03（基本設計）  
**次Phase**: Phase 04（詳細設計）

---

## プロジェクト概要

### 達成目標
現在Accessで動いてるシステムのWEB版をリリースする

### システム概要
自社の社員向けに、日々の顧客からの問い合わせや、それに対する対応を入力し、記録・分析を行うもの

### 技術スタック
- **DB**: SQL Server 2022（継続）
- **DB接続**: PDO（PHP）
- **データ操作**: ストアドプロシージャ（継続）/（一部PHP）
- **フロント**: PHP 7.4+ / HTML5 / CSS3 / jQuery 1.11.3

---

## 作業ディレクトリ

- **作業ディレクトリ**: `D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\`
- **検証ディレクトリ**: `\\LPG-NEMA\C\inetpub\wwwroot\support-system\`
- **本番ディレクトリ**: `\\DEV-SE\C\inetpub\wwwroot\support-system\`

---

## Phase 03 完了成果物

### 03_設計/画面設計書/
1. `login.md` - ログイン画面設計書
2. `main.md` - メイン画面設計書
3. `input_dialog.md` - 入力ダイアログ設計書
4. `master.md` - マスタ保守画面設計書

### 03_設計/機能設計書/
1. `auth.md` - 認証機能設計書
2. `search.md` - 検索機能設計書
3. `crud.md` - CRUD機能設計書
4. `product_select.md` - 商品選択機能設計書
5. `template_select.md` - 定型文選択機能設計書
6. `master_maintenance.md` - マスタ保守機能設計書

### 03_設計/
1. `system_overview.md` - システム全体設計書
2. `data_flow.md` - データフロー図
3. `api_spec.md` - 内部API設計書

---

## Phase 04 作業内容

### 目的
Phase 03で作成した基本設計に基づき、より詳細なデータベース設計とストアドプロシージャ仕様を策定する。

### 成果物

#### 1. DB設計書
- テーブル詳細定義（全カラム、データ型、制約）
- インデックス設計
- 外部キー制約
- トリガー仕様（必要に応じて）

#### 2. ストアドプロシージャ仕様書
- 既存SPの一覧と仕様確認
- 新規必要SPの設計
- パラメータ定義
- 戻り値定義

#### 3. セッション管理仕様書
- セッション変数一覧
- セッションライフサイクル
- タイムアウト処理

#### 4. エラーハンドリング仕様書
- エラーコード体系
- エラーメッセージ一覧
- エラー画面仕様

#### 5. セキュリティ仕様書
- 認証・認可仕様
- 入力検証仕様
- XSS/SQLインジェクション対策

#### 6. Phase 05用プロンプト

### 格納先
- `D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\03_設計\`

---

## 必須参照ドキュメント

作業開始前に必ず以下のドキュメントを読み込んでください：

### 規約書
1. `01_規約/開発規約書.md` - 開発の基本方針、技術スタック
2. `01_規約/コーディング規約書.md` - コーディングルール
3. `01_規約/ディレクトリ構造設計書.md` - ディレクトリ構成

### 分析資料
1. `02_分析/テーブル定義書.md` - 既存DB構造
2. `02_分析/ストアドプロシージャ一覧.md` - 既存SP一覧

### 設計書（Phase 03成果物）
1. `03_設計/system_overview.md` - システム全体設計
2. `03_設計/api_spec.md` - API仕様

---

## 作業進行の制約

1. **大容量ファイルの分割処理**
   - ファイル読み込みは必要に応じて分割
   - ファイル書き込みも大きい場合は分割

2. **成果物出力**
   - 作業ディレクトリのみにファイル出力
   - チャットでは出力結果の報告のみ

3. **トークン節約**
   - 長尺タスクは分割処理
   - 不要な出力を控える

4. **チャット容量管理**
   - 容量オーバーになる前に次チャット立ち上げを促す
   - プロンプトファイルを生成して継続性を確保

---

## 作業開始指示

1. 上記の必須参照ドキュメントを読み込む
2. Phase 03成果物を確認し、詳細設計の方針を立てる
3. DB設計書から順に作成開始
4. 既存のストアドプロシージャを分析し、仕様書を作成
5. セッション管理、エラーハンドリング、セキュリティ仕様を策定
6. Phase 05用プロンプトを生成

---

## 確認事項

Phase 04開始時に以下を確認してください：

- [ ] 01_規約/開発規約書.md を読み込んだ
- [ ] 02_分析/テーブル定義書.md を読み込んだ
- [ ] 02_分析/ストアドプロシージャ一覧.md を読み込んだ
- [ ] 03_設計/system_overview.md を読み込んだ
- [ ] 03_設計/api_spec.md を読み込んだ

上記確認後、作業を開始してください。

---

**作成者**: Claude AI  
**Phase 03完了日**: 2025-11-25
