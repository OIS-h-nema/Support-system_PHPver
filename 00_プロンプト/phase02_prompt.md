# サポート報告書WEBシステム開発プロジェクト - Phase 02

## プロジェクト概要

### 達成目標
現在Accessで動いているサポート報告書管理システムのWEB版をリリースする

### システム概要
自社の社員向けに、日々の顧客からの問い合わせや、それに対する対応を入力し、記録・分析を行うシステム

---

## 技術仕様

### 旧システム
- **DB**: SQL Server
- **DB接続**: PDO
- **データ操作**: ストアドプロシージャ（一部VBA）
- **フロント**: MS Access

### 新システム
- **DB**: SQL Server 2022（継続）
- **DB接続**: PDO（PHP）
- **データ操作**: ストアドプロシージャ（継続）/（一部PHP）
- **フロント**: PHP 7.4 / HTML / CSS / jQuery 1.11
- **CSSフレームワーク**: 独自CSS（参考システムを踏襲）
- **セキュリティ**: 社内ネットワーク限定のため今回無視

---

## ディレクトリ構成

### 作業ディレクトリ
```
D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\
```

### 検証ディレクトリ
```
\\LPG-NEMA\C\inetpub\wwwroot\support-system\
```

### 本番ディレクトリ
```
\\DEV-SE\C\inetpub\wwwroot\support-system\
```

### 参考システム
- **共通関数**: `C:\inetpub\func\`
- **既存WEBシステム**: `C:\inetpub\wwwroot\ois-web\`

### 現行システム資料
- **ナレッジフォルダ**: `D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\ナレッジ\`
  - SUPPORT_PG.accdb（Accessファイル）
  - SUPPORT_PG.accdb.AsText.20251118_1329（テキスト化されたAccess構造）
  - スクリーンショット（画面イメージ）
  - DB.ipynb（データベース情報）

---

## プロジェクト実行制約

1. **AI主導開発**: なるべく人間の作業をなくし、ClaudeAIに分析、設計、製造、検証、修正と調整、環境構築の全ての工程を実施させる

2. **フェーズ管理**: 
   - 進行に応じていくつかのフェーズに分け、フェーズごとに新規でチャットを立ち上げる
   - 出力するファイルについてはフェーズごとにディレクトリを生成し、そこに出力する

3. **プロンプト継承**:
   - フェーズ移行/チャット終了ごとに、次のチャットの最初に実行するプロンプトを生成する
   - チャットが容量オーバーになる前に次のチャット立ち上げを促す
   - プロンプトの生成には作業ディレクトリの中に専用のディレクトリ（00_プロンプト）を使用
   - プロンプトにはチャットを跨いでもプロジェクトの規約や工程を常に把握できるようにする

4. **日本語命名**: チャットのタイトルは日本語で命名する

---

## プロジェクト進行手順（全体）

1. ✓ プロジェクトの達成目標に向けた工程と規約の検討
2. ✓ 規約に従って作業ディレクトリ階層の作成
3. ✓ プロジェクトの達成目標に向けた工程と規約の資料の出力
4. 現状のシステムのアップロードと分析 ← **Phase 02の範囲**
5. 参考システムの分析 ← **Phase 02の範囲**（Phase 01で一部完了）
6. 分析結果を受けた規約の改修
7. システムの設計と仕様書の作成
8. 仕様書のレビューと調整
9. DB接続までの製造作業
10. DB接続までの検証と調整
11. メイン画面の簡易版の作成

---

## Phase 01 完了状況

### ✅ 完了した成果物

#### 01_規約/
- [x] 開発規約書.md
- [x] コーディング規約書.md
- [x] ディレクトリ構造設計書.md
- [x] プロジェクト工程表.md

#### 02_分析/
- [x] 参考システム分析結果.md

#### 00_プロンプト/
- [x] phase01_prompt.md
- [x] phase02_prompt.md（本ファイル）

### 📋 Phase 01で確認された重要事項

#### 参考システムの特徴
- **セッション**: 9時間タイムアウト、セッション名'silps'
- **DB接続**: PDO（SQL Server）、inc.phpで一元管理
- **共通関数**: myFunction.phpに画像処理、文字列処理、数値処理、日付処理など
- **ファイル命名規則**: `[機能]_[種類].php`（例: ken_main.php）
- **レスポンシブ対応**: PC/Tablet/SP用のCSS分離
- **VBA互換関数**: Nz(), Ez()（Accessからの移行を考慮）

#### 開発規約のポイント
- **UTF-8統一**: 全ファイルUTF-8（BOMなし）
- **PHPDoc形式**: 関数・クラスにはPHPDocコメント必須
- **エラーハンドリング**: try-catchによる例外処理
- **セキュリティ**: HTMLエスケープ、SQLインジェクション対策

---

## Phase 02 での実施内容（手順4〜6）

### 4. 現状のシステムのアップロードと分析

**実施事項**:
- 現行Accessシステムの詳細分析
  - テーブル構造の抽出と整理
  - ストアドプロシージャの一覧作成
  - VBA処理の分析（ロジックの把握）
  - クエリ定義の分析
  - フォーム・レポート定義の確認
- 画面キャプチャの分析
  - 各画面のレイアウト把握
  - 入力項目・表示項目の洗い出し
  - 画面遷移フローの作成
- DB.ipynbの内容確認

**成果物**:
- テーブル定義書.md（02_分析/）
- ストアドプロシージャ一覧.md（02_分析/）
- VBA処理分析結果.md（02_分析/）
- クエリ定義一覧.md（02_分析/）
- 画面構成一覧.md（02_分析/）
- 画面遷移図.md（02_分析/）

### 5. 参考システムの分析（追加分析）

**実施事項**:
- Phase 01で未実施の詳細分析
- 既存WEBシステムの画面構造の深堀り
- JavaScriptの使用パターンの確認
- CSSのレスポンシブ実装方法の確認

**成果物**:
- 参考システム詳細分析.md（02_分析/）（既存ファイルへの追記）

### 6. 分析結果を受けた規約の改修

**実施事項**:
- Accessシステムの分析結果を踏まえた規約の見直し
- 必要に応じて開発規約・コーディング規約の改修
- 画面設計の基本方針の追加
- データ移行方針の策定

**成果物**:
- 開発規約書.md（改訂版）（01_規約/）
- 画面設計基本方針.md（01_規約/）
- データ移行方針.md（02_分析/）

---

## Phase 02 分析対象ファイル

### ナレッジフォルダの構成

```
D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\ナレッジ\
├── DB.ipynb                                      # データベース情報
├── SUPPORT_PG.accdb                              # Accessファイル本体
├── SUPPORT_PG.accdb.AsText.20251118_1329/        # テキスト化されたAccess構造
│   ├── *.table                                   # テーブル定義（25ファイル）
│   ├── *.form                                    # フォーム定義（15ファイル）
│   ├── *.module                                  # VBAモジュール（14ファイル）
│   ├── *.query                                   # クエリ定義（26ファイル）
│   ├── *.report                                  # レポート定義（1ファイル）
│   └── *.macro                                   # マクロ定義（2ファイル）
└── スクリーンショット/                            # 画面キャプチャ（8ファイル）
    ├── システムメイン画面.png
    ├── ログイン.png
    ├── 入力ダイアログ.png
    ├── 検索アコーディオン展開.png
    ├── マスタ設定_商品.png
    ├── マスタ設定_定型文.png
    ├── マスタ設定_対応内容項目.png
    └── マスタ設定_対応区分.png
```

### 重要ファイルの分類

#### テーブル定義（*.table）
**優先度：高**
- `D_作業報告.table`: メインデータテーブル
- `M_商品.table`: 商品マスタ
- `M_定型文.table`: 定型文マスタ
- `M_対応区分.table`: 対応区分マスタ
- `M_対応内容項目.table`: 対応内容項目マスタ
- `SQL_顧客.table`: 顧客情報（SQL Server連携）
- `SQL_作業担当.table`: 担当者情報（SQL Server連携）
- `SQL_部門.table`: 部門情報（SQL Server連携）

#### VBAモジュール（*.module）
**優先度：高**
- `$標準モジュール.module`: 標準処理
- `$標準ライブラリ.module`: 共通ライブラリ
- `$テーブル操作.module`: テーブル操作処理
- `SQL_顧客.module`: 顧客情報取得処理
- `SQL_作業担当.module`: 担当者情報取得処理
- `SQL_部門.module`: 部門情報取得処理

#### フォーム定義（*.form）
**優先度：高**
- `サポート報告_一覧表.form`: メイン画面
- `サポート報告_入力ダイアログ.form`: 入力ダイアログ
- `サポート報告_入力ダイアログ_定型文ダイアログ.form`: 定型文選択
- `LoginBox.form`: ログイン画面
- `保守_商品.form`: 商品マスタ保守
- `保守_定型文.form`: 定型文マスタ保守
- `保守_対応区分.form`: 対応区分マスタ保守
- `保守_対応内容項目.form`: 対応内容項目マスタ保守

#### クエリ定義（*.query）
**優先度：中**
- `FQ_サポート報告_一覧表_明細.query`: 一覧表示用クエリ
- `CQ_*.query`: コンボボックス用クエリ
- `FQ_保守_*.query`: マスタ保守用クエリ

---

## Phase 02 実施手順

### ステップ1: テーブル構造の分析
1. `D_作業報告.table`を読み込み、メインテーブルの構造を把握
2. マスタテーブル（M_*.table）の構造を分析
3. SQL Server連携テーブル（SQL_*.table）の構造を確認
4. テーブル定義書を作成

### ステップ2: ストアドプロシージャの分析
1. `DB.ipynb`からストアドプロシージャの一覧を抽出
2. 各ストアドプロシージャの役割を分類
3. ストアドプロシージャ一覧を作成

### ステップ3: VBA処理の分析
1. 主要なVBAモジュールを読み込み
2. 処理ロジックを分析し、PHP化の方針を検討
3. VBA処理分析結果を作成

### ステップ4: 画面構造の分析
1. スクリーンショットを確認
2. フォーム定義（*.form）を読み込み、画面構成を把握
3. 画面遷移フローを作成
4. 入力項目・表示項目の一覧を作成

### ステップ5: クエリ定義の分析
1. 主要なクエリ定義を読み込み
2. SQLの構造を分析
3. WEB化時の実装方針を検討

### ステップ6: 要件定義書の作成
1. 分析結果を統合
2. 機能要件を整理
3. 非機能要件を定義
4. 要件定義書を作成

### ステップ7: 規約の見直し
1. 分析結果を踏まえ、開発規約を見直し
2. 画面設計基本方針を追加
3. データ移行方針を策定

### ステップ8: Phase 03用プロンプトの生成
1. Phase 03（基本設計）で実施する内容を明確化
2. 必要な前提知識を含めたプロンプトを作成
3. `00_プロンプト/phase03_prompt.md`として保存

---

## Phase 02 成果物一覧

| No | 成果物名 | 格納場所 | 目的 |
|----|---------|---------|------|
| 1 | テーブル定義書.md | 02_分析/ | テーブル構造の整理 |
| 2 | ストアドプロシージャ一覧.md | 02_分析/ | SP の役割と仕様を記録 |
| 3 | VBA処理分析結果.md | 02_分析/ | VBAロジックのPHP化方針 |
| 4 | クエリ定義一覧.md | 02_分析/ | クエリの整理と実装方針 |
| 5 | 画面構成一覧.md | 02_分析/ | 画面ごとの項目・機能整理 |
| 6 | 画面遷移図.md | 02_分析/ | 画面間の遷移フロー |
| 7 | 機能要件定義書.md | 02_分析/ | システムが実現すべき機能 |
| 8 | 非機能要件定義書.md | 02_分析/ | 性能・保守性等の要件 |
| 9 | データ移行方針.md | 02_分析/ | 既存データの移行方法 |
| 10 | 開発規約書.md（改訂版） | 01_規約/ | 分析結果を反映した規約 |
| 11 | 画面設計基本方針.md | 01_規約/ | WEB画面設計の指針 |
| 12 | phase03_prompt.md | 00_プロンプト/ | Phase 03開始プロンプト |

---

## 開始指示

上記の内容を踏まえて、Phase 02（手順4〜6）を実施してください。

**実施順序**:
1. テーブル構造の分析（D_作業報告.table、M_*.table、SQL_*.table）
2. ストアドプロシージャの分析（DB.ipynb）
3. VBA処理の分析（主要なVBAモジュール）
4. 画面構造の分析（スクリーンショット、*.form）
5. クエリ定義の分析（主要なクエリ）
6. 要件定義書の作成
7. 規約の見直しと追加
8. Phase 03用プロンプトの生成

**重要事項**:
- 全ての成果物は作業ディレクトリ配下の適切な場所に出力してください
- 分析結果は具体的かつ詳細に記録してください
- Phase 03で画面設計を行うための十分な情報を収集してください
- チャットのトークン使用量に注意し、容量オーバーが近づいたら次のチャットへの移行を提案してください

---

**Phase 02 開始**: このプロンプトを新しいチャットで実行してください。  
**チャットタイトル（日本語）**: 「サポート報告書WEB化 Phase02 要件分析」
