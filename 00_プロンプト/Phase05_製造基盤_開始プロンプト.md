# Phase 05 製造（基盤構築）開始プロンプト

**作成日**: 2025-11-25  
**前Phase**: Phase 04（詳細設計）  
**次Phase**: Phase 05（製造 - 基盤構築）

---

## プロジェクト概要

### 達成目標
現在Accessで動いてるシステムのWEB版をリリースする

### システム概要
自社の社員向けに、日々の顧客からの問い合わせや、それに対する対応を入力し、記録・分析を行うもの

### 技術スタック
- **DB**: SQL Server 2022（継続）
- **DB接続**: PDO（PHP）
- **データ操作**: ストアドプロシージャ（継続）/（一部PHP）
- **フロント**: PHP 7.4+ / HTML5 / CSS3 / jQuery 1.11.3

---

## 作業ディレクトリ

- **作業ディレクトリ**: `D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\`
- **検証ディレクトリ**: `\\LPG-NEMA\C\inetpub\wwwroot\support-system\`
- **本番ディレクトリ**: `\\DEV-SE\C\inetpub\wwwroot\support-system\`

---

## Phase 04 完了成果物

### 03_設計/（詳細設計書）
1. `DB詳細設計書.md` - テーブル詳細定義、インデックス設計
2. `ストアドプロシージャ詳細設計書.md` - 既存SP仕様、新規SP設計
3. `セッション管理仕様書.md` - セッション変数、ライフサイクル
4. `エラーハンドリング仕様書.md` - エラーコード、画面表示
5. `セキュリティ仕様書.md` - 認証・認可、XSS/SQLi対策

### 03_設計/画面設計書/
- `login.md` - ログイン画面設計書
- `main.md` - メイン画面設計書
- `input_dialog.md` - 入力ダイアログ設計書
- `master.md` - マスタ保守画面設計書

### 03_設計/機能設計書/
- `auth.md` - 認証機能設計書
- `search.md` - 検索機能設計書
- `crud.md` - CRUD機能設計書
- その他機能設計書

---

## Phase 05 作業内容

### 目的
Phase 03-04で作成した設計に基づき、システムの基盤部分を構築する。

### 成果物

#### 1. ディレクトリ構造作成
```
04_製造/
├── includes/
│   ├── config.php          # 設定ファイル
│   ├── auth.php            # 認証モジュール
│   ├── functions.php       # 独自関数
│   ├── error.php           # エラーハンドリング
│   └── validation.php      # バリデーション
├── css/
│   ├── common.css          # 共通CSS
│   ├── pc.css              # PC用CSS
│   ├── tablet.css          # タブレット用CSS
│   └── sp.css              # スマートフォン用CSS
├── js/
│   ├── common.js           # 共通JavaScript
│   └── support.js          # サポート報告書用JS
└── logs/                   # ログディレクトリ
```

#### 2. 基盤ファイル作成

##### config.php
- データベース接続設定
- セッション設定
- 定数定義（エラーコード等）
- 環境設定（開発/本番切り替え）

##### auth.php
- ログイン認証関数
- ログアウト関数
- セッションチェック関数
- 権限チェック関数

##### functions.php
- 共通関数（エスケープ、日付処理等）
- VBA互換関数
- Ajax応答関数

##### error.php
- エラークラス定義
- グローバルエラーハンドラー
- ログ出力関数

##### validation.php
- バリデーションクラス
- 各種検証関数

#### 3. 共通CSSファイル
- レスポンシブ対応CSS
- 共通コンポーネントスタイル

#### 4. 共通JavaScriptファイル
- Ajax通信ラッパー
- 共通ユーティリティ関数
- エラー表示関数

#### 5. Phase 06用プロンプト

### 格納先
- `D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\04_製造\`

---

## 必須参照ドキュメント

作業開始前に必ず以下のドキュメントを読み込んでください：

### 規約書
1. `01_規約/開発規約書.md` - 開発の基本方針、技術スタック
2. `01_規約/コーディング規約書.md` - コーディングルール

### 詳細設計書（Phase 04成果物）
1. `03_設計/DB詳細設計書.md` - データベース詳細設計
2. `03_設計/ストアドプロシージャ詳細設計書.md` - SP仕様
3. `03_設計/セッション管理仕様書.md` - セッション仕様
4. `03_設計/エラーハンドリング仕様書.md` - エラー処理仕様
5. `03_設計/セキュリティ仕様書.md` - セキュリティ仕様

### 参考資料
1. `C:\inetpub\func\inc.php` - 既存DB接続設定
2. `C:\inetpub\func\myFunction.php` - 既存共通関数

---

## 作業進行の制約

1. **大容量ファイルの分割処理**
   - ファイル読み込みは必要に応じて分割
   - ファイル書き込みも大きい場合は分割

2. **成果物出力**
   - 作業ディレクトリのみにファイル出力
   - チャットでは出力結果の報告のみ

3. **トークン節約**
   - 長尺タスクは分割処理
   - 不要な出力を控える

4. **チャット容量管理**
   - 容量オーバーになる前に次チャット立ち上げを促す
   - プロンプトファイルを生成して継続性を確保

---

## 実装仕様

### config.php 実装項目

```php
<?php
// 環境設定
define('DEBUG_MODE', true);  // 開発時true、本番時false

// データベース設定
define('DB_SERVER', 'dev-se02\\SQL22');
define('DB_NAME', 'SUPPORTDB');
define('DB_USER', '（設定値）');
define('DB_PASS', '（設定値）');

// セッション設定
define('SESSION_LIFETIME', 32400);  // 9時間

// パス設定
define('BASE_PATH', dirname(__FILE__) . '/../');
define('FUNC_PATH', 'C:/inetpub/func/');
```

### auth.php 実装項目

- `authenticate($user_id, $password)` - 認証処理
- `logout()` - ログアウト処理
- `isLoggedIn()` - ログインチェック
- `isAdmin()` - 管理者チェック
- `requireLogin()` - ページ用認証必須
- `requireAdmin()` - ページ用管理者必須
- `checkSessionForAjax()` - Ajax用認証チェック

### functions.php 実装項目

- 既存myFunction.phpの関数を継承
- VBA互換関数（日付処理、文字列処理）
- `jsonResponse($status, $data, $message)` - Ajax応答
- `sanitizeInput($value, $type)` - 入力サニタイズ

### validation.php 実装項目

- `Validator` クラス
- 必須チェック、文字数チェック、数値チェック
- 日付チェック、範囲チェック

---

## 作業開始指示

1. 上記の必須参照ドキュメントを読み込む
2. 04_製造ディレクトリ構造を作成
3. config.phpを作成（DB接続設定、セッション設定）
4. auth.phpを作成（認証モジュール）
5. functions.phpを作成（共通関数）
6. error.phpを作成（エラーハンドリング）
7. validation.phpを作成（バリデーション）
8. 共通CSS/JSファイルを作成
9. Phase 06用プロンプトを生成

---

## 確認事項

Phase 05開始時に以下を確認してください：

- [ ] 01_規約/開発規約書.md を読み込んだ
- [ ] 03_設計/セッション管理仕様書.md を読み込んだ
- [ ] 03_設計/エラーハンドリング仕様書.md を読み込んだ
- [ ] 03_設計/セキュリティ仕様書.md を読み込んだ
- [ ] C:\inetpub\func\inc.php を参照した
- [ ] C:\inetpub\func\myFunction.php を参照した

上記確認後、作業を開始してください。

---

## 品質チェックリスト

Phase 05完了時に以下を確認：

- [ ] config.phpでDB接続が正常に動作するか
- [ ] セッション設定が仕様通りか
- [ ] 認証関数が正常に動作するか
- [ ] エスケープ関数が正しく実装されているか
- [ ] バリデーション関数が正常に動作するか
- [ ] CSSがレスポンシブ対応しているか
- [ ] JSの共通関数が動作するか

---

**作成者**: Claude AI  
**Phase 04完了日**: 2025-11-25
