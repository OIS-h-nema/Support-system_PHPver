# サポート報告書WEBシステム Phase 03 開始プロンプト

**作成日**: 2025-11-25  
**対象Phase**: Phase 03  
**前Phase**: Phase 02  
**作成者**: Claude AI

---

## 1. プロジェクト概要

### 1.1 達成目標
現在MS Accessで稼働しているサポート報告書管理システムをWEB化し、社内ネットワーク上で利用可能にする。

### 1.2 システム概要
自社の社員向けに、日々の顧客からの問い合わせや、それに対する対応を入力し、記録・分析を行うシステム。

### 1.3 旧システム仕様
- **DB**: SQL Server
- **DB接続**: PDO
- **データ操作**: ストアドプロシージャ（一部VBA）
- **フロント**: MS Access

### 1.4 新システム仕様
- **DB**: SQL Server（継続）
- **DB接続**: PDO（PHP）
- **データ操作**: ストアドプロシージャ（継続）/（一部PHP）
- **フロント**: PHP/HTML/CSS/jQuery

---

## 2. 環境情報

### 2.1 ディレクトリ構成
- **作業ディレクトリ**: `D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\`
- **検証ディレクトリ**: `\\LPG-NEMA\C\inetpub\wwwroot\support-system\`
- **本番ディレクトリ**: `\\DEV-SE\C\inetpub\wwwroot\support-system\`

### 2.2 参照システム
- **共通関数**: `C:\inetpub\func\`
  - inc.php: DB接続、セッション管理
  - myFunction.php: 共通関数ライブラリ
  - myConvert.php: 文字コード変換
- **参考システム**: `C:\inetpub\wwwroot\ois-web\`

---

## 3. プロジェクトの制約事項

### 3.1 AI主導開発
- 全工程（分析、設計、製造、検証、調整、環境構築）をClaude AIが実施
- 人間の作業を最小限に抑える

### 3.2 フェーズ管理
- フェーズごとに新規チャットを立ち上げ
- フェーズごとに専用ディレクトリに成果物を出力
- チャット移行時に次フェーズ用プロンプトを生成

### 3.3 トークン節約
- 長尺タスクは分割して処理
- 大容量ファイルの書き込みは分割実行
- 大容量ファイルの読み込みは分割実行
- 成果物は作業ディレクトリに直接出力（チャットは報告のみ）

### 3.4 ファイル出力
- 成果物の出力先: 作業ディレクトリのみ
- チャット内: 出力結果の報告のみ
- ファイルパスは必ず確認してから出力

### 3.5 その他制約
- **既存資産の活用**: SQL Serverデータベースとストアドプロシージャをそのまま継承
- **標準技術の採用**: PHP + HTML + CSS + jQueryによる標準的なWEBアプリケーション構成
- **参考システムの活用**: 既存のois-webシステムの構造・関数を参考にする
- **社内ネットワーク限定**: セキュリティは社内ネットワーク前提で最小限
- **日本語命名**: チャットのタイトルは日本語で命名

---

## 4. 前フェーズまでの進捗

### 4.1 完了フェーズ

| Phase | フェーズ名 | 状態 | 完了日 |
|-------|-----------|------|--------|
| 01 | 規約策定 | ✓完了 | 2025-11-20 |
| 02 | 要件分析 | ✓完了 | 2025-11-25 |

### 4.2 主要成果物

**Phase 01: 規約策定**
- 開発規約書.md
- コーディング規約書.md
- ディレクトリ構造設計書.md
- プロジェクト工程表.md
- プロンプト生成規約書.md

**Phase 02: 要件分析**
- テーブル定義書.md - SQL Serverの全テーブル構造（14テーブル）
- ストアドプロシージャ一覧.md - 全SPの役割と仕様（41個）
- VBA処理分析結果.md - VBAロジックのPHP化方針
- クエリ定義一覧.md - 全クエリの整理と実装方針
- 画面構成一覧.md - 各画面の項目・機能を詳細に整理
- 画面遷移図.md - 画面間の遷移フロー
- 機能要件定義書.md - システムが実現すべき機能
- データ移行方針.md - 既存データの移行方法
- 参考システム分析結果.md - ois-webシステムの分析
- 非機能要件定義書.md - 性能・保守性・セキュリティ等の要件
- 開発規約書.md（v1.1） - Phase 02の分析結果を反映
- 画面設計基本方針.md - 画面設計の統一方針

### 4.3 引き継ぎ事項

#### データベース構成
- **テーブル数**: 14テーブル（マスタ5、データ9）
- **ストアドプロシージャ**: 41個（SELECT 15、INSERT 10、UPDATE 10、DELETE 6）
- **主要テーブル**: D_サポート報告書、M_担当者、M_商品、M_定型文、M_対応区分、M_対応内容項目

#### 画面構成
- **ログイン画面**: 担当者コード・パスワードで認証
- **メイン画面**: 一覧表示、検索機能、新規登録・編集・削除
- **入力ダイアログ（モーダル）**: サポート報告書の登録・更新
- **マスタ保守画面**: 商品、定型文、対応区分、対応内容項目の管理

#### 重要な機能
- **商品選択**: 最大3件まで選択可能
- **定型文選択**: モーダルダイアログで選択し、対応内容に挿入
- **対応内容チェックボックス**: 20項目からチェック（ビットマスク保存）
- **検索機能**: アコーディオン形式、複数条件での絞り込み
- **ページング**: 50件/ページ、OFFSET-FETCH使用

#### 技術的ポイント
- **VBA処理のPHP化**: 日付処理、文字列処理、データ操作をPHPで再現
- **Ajax通信**: 商品検索、定型文取得等
- **レスポンシブ対応**: PC/Tablet/SP用のCSS分離

---

## 5. 当フェーズ（Phase 03）の作業内容

### 5.1 フェーズ概要
**フェーズ名**: 基本設計  
**目的**: システムの基本設計を完成させ、Phase 04（詳細設計）、Phase 05（製造）への準備を整える

### 5.2 実施タスク

- [ ] ディレクトリ作成（03_設計/画面設計書/、03_設計/機能設計書/）
- [ ] 画面設計書の作成
  - [ ] login.md（ログイン画面設計書）
  - [ ] main.md（メイン画面設計書）
  - [ ] input_dialog.md（入力ダイアログ設計書）
  - [ ] master.md（マスタ保守画面設計書）
- [ ] 機能設計書の作成
  - [ ] auth.md（ログイン・認証機能設計書）
  - [ ] search.md（検索機能設計書）
  - [ ] crud.md（登録・更新機能設計書）
  - [ ] product_select.md（商品選択機能設計書）
  - [ ] template_select.md（定型文選択機能設計書）
  - [ ] master_maintenance.md（マスタ保守機能設計書）
- [ ] その他設計書の作成
  - [ ] system_overview.md（システム全体設計書）
  - [ ] data_flow.md（データフロー図）
  - [ ] api_spec.md（内部API設計書）
- [ ] Phase 04用プロンプトの生成（プロンプト生成規約書に従う）

### 5.3 成果物と格納場所

| No | 成果物名 | 格納場所 | 形式 |
|----|---------|---------|------|
| 1 | login.md | 03_設計/画面設計書/ | .md |
| 2 | main.md | 03_設計/画面設計書/ | .md |
| 3 | input_dialog.md | 03_設計/画面設計書/ | .md |
| 4 | master.md | 03_設計/画面設計書/ | .md |
| 5 | auth.md | 03_設計/機能設計書/ | .md |
| 6 | search.md | 03_設計/機能設計書/ | .md |
| 7 | crud.md | 03_設計/機能設計書/ | .md |
| 8 | product_select.md | 03_設計/機能設計書/ | .md |
| 9 | template_select.md | 03_設計/機能設計書/ | .md |
| 10 | master_maintenance.md | 03_設計/機能設計書/ | .md |
| 11 | system_overview.md | 03_設計/ | .md |
| 12 | data_flow.md | 03_設計/ | .md |
| 13 | api_spec.md | 03_設計/ | .md |
| 14 | Phase03_to_Phase04.md | 00_プロンプト/ | .md |

### 5.4 参照ドキュメント

**必須参照**:
1. `01_規約/開発規約書.md（v1.1）` - 開発全体の規約
2. `01_規約/コーディング規約書.md` - コーディング規約
3. `01_規約/ディレクトリ構造設計書.md` - ディレクトリ構造
4. `01_規約/プロジェクト工程表.md` - 全体工程
5. `01_規約/画面設計基本方針.md` - 画面設計の統一方針

**Phase別参照**:
- `02_分析/テーブル定義書.md` - DB構造
- `02_分析/ストアドプロシージャ一覧.md` - SP仕様
- `02_分析/VBA処理分析結果.md` - VBAのPHP化方針
- `02_分析/画面構成一覧.md` - 各画面の詳細
- `02_分析/画面遷移図.md` - 画面の流れ
- `02_分析/機能要件定義書.md` - 実現すべき機能
- `02_分析/非機能要件定義書.md` - 性能・保守性等の要件

### 5.5 設計書の記載内容

各設計書には以下を必ず記載する：

1. **概要**: 画面/機能の目的と役割
2. **レイアウト**: PC/Tablet/SP別のレイアウト（図解含む）
3. **項目定義**: 各入力項目の詳細（型、桁数、必須/任意、デフォルト値等）
4. **処理フロー**: 処理の流れをフローチャートまたはテキストで記載
5. **バリデーション**: 入力チェックの詳細
6. **データベース連携**: 使用するテーブル・SP
7. **Ajax通信**: 非同期通信の仕様
8. **エラーハンドリング**: エラー時の動作
9. **画面遷移**: 遷移先と遷移条件
10. **備考**: その他の注意事項

---

## 6. 規約・制約の要点

### 6.1 開発規約の要点

**技術スタック**:
- PHP 7.4以上
- jQuery 1.11系
- SQL Server 2022
- 文字コード: UTF-8

**ファイル命名規則**:
- メイン画面: `[機能名]_main.php`
- 一覧画面: `[機能名]_list.php`
- 登録画面: `[機能名]_ins.php`
- 更新画面: `[機能名]_upd.php`
- 検索画面: `[機能名]_kensaku[番号].php`
- Ajax処理: `[機能名]_ajax[番号].php`

**セキュリティ**:
- 入力値は必ずサニタイズ（htmlspecialchars）
- SQLインジェクション対策: プリペアドステートメント使用
- XSS対策: 出力時にエスケープ処理

### 6.2 コーディング規約の要点

**PHP**:
- 変数名: スネークケース（snake_case）
- 定数: 大文字スネークケース（UPPER_SNAKE_CASE）
- 関数名: スネークケース（snake_case）
- インデント: タブまたはスペース4つ

**HTML**:
- DOCTYPE: XHTML 1.0 Transitional
- name属性: スネークケース
- id属性: ケバブケース（kebab-case）

**CSS**:
- クラス名: ケバブケース（kebab-case）
- PC/Tablet/SP用に分離（pc.css, tablet.css, sp.css）

**JavaScript**:
- jQuery 1.11.3を使用
- 変数名: キャメルケース（camelCase）

### 6.3 ディレクトリ構造
```
サポート報告書WEB/
├── 00_プロンプト/       # プロンプト保存
├── 01_規約/            # 開発規約・設計書
├── 02_分析/            # 現行システム分析資料
├── 03_設計/            # システム設計書（今回作成）
│   ├── 画面設計書/
│   └── 機能設計書/
├── 04_製造/            # 開発ソースコード
├── 05_検証/            # テスト資料
├── 06_調整/            # 調整・修正履歴
├── 07_環境構築/        # 環境構築手順書
├── 08_ドキュメント/     # 各種ドキュメント
└── ナレッジ/           # 参考資料（既存）
```

### 6.4 画面設計基本方針

**設計の基本方針**:
1. **既存システムとの連続性** - Accessシステムからの移行をスムーズに
2. **使いやすさ最優先** - ユーザーが直感的に操作できる設計
3. **レスポンシブ対応** - PC/Tablet/SPで最適な表示
4. **保守性の確保** - モジュール化された設計
5. **性能の確保** - レスポンスタイム目標を達成

---

## 7. 作業開始時の確認事項

### 7.1 初期確認
チャット開始時に以下を必ず確認してください：

1. **ディレクトリの存在確認**
   ```
   作業ディレクトリが存在するか確認: D:\#M\PG_DATA\OIS社内システム\PG_DATA\サポート報告書WEB\
   成果物の格納先ディレクトリを作成: 03_設計/画面設計書/、03_設計/機能設計書/
   ```

2. **必須ドキュメントの確認**
   ```
   01_規約/開発規約書.md を読み込み
   01_規約/コーディング規約書.md を読み込み
   01_規約/画面設計基本方針.md を読み込み
   02_分析/ 配下の各分析資料を必要に応じて読み込み
   ```

3. **前フェーズ成果物の確認**
   ```
   Phase 02の成果物が全て存在するか確認
   特にテーブル定義書、画面構成一覧、機能要件定義書を重点確認
   ```

### 7.2 初期タスク
以下の順序で作業を開始してください：

1. **環境確認**
   - 作業ディレクトリの確認
   - 必要なサブディレクトリの作成

2. **規約の確認**
   - 開発規約書、コーディング規約書の読み込み
   - 画面設計基本方針の読み込み
   - Phase 02分析資料の確認

3. **タスクの開始**
   - 画面設計書から作成開始（login → main → input_dialog → master）
   - 次に機能設計書を作成
   - 最後にシステム全体設計書等を作成

### 7.3 作業中の注意事項

1. **ファイル出力**
   - 必ず作業ディレクトリに出力
   - ファイルパスを事前に確認
   - 上書き前にバックアップの必要性を検討

2. **トークン管理**
   - 設計書は詳細に記載するが、必要に応じて分割作成
   - 長尺タスクは段階的に実行
   - 定期的にトークン使用量を確認（70%超過で次チャット検討）

3. **エラー対応**
   - エラー発生時は詳細を記録
   - 解決策を試行
   - 必要に応じて代替案を検討

---

## 8. 次フェーズへの準備

### 8.1 完了確認項目
Phase 03終了時に以下を確認してください：

- [ ] ディレクトリが作成されている（03_設計/画面設計書/、03_設計/機能設計書/）
- [ ] 画面設計書4本が完成している（login, main, input_dialog, master）
- [ ] 機能設計書6本が完成している（auth, search, crud, product_select, template_select, master_maintenance）
- [ ] システム全体設計書が完成している（system_overview）
- [ ] データフロー図が完成している（data_flow）
- [ ] 内部API設計書が完成している（api_spec）
- [ ] 全ての設計書が画面設計基本方針に準拠している
- [ ] 設計書間で矛盾がない
- [ ] Phase 02の分析結果が適切に反映されている
- [ ] Phase 04（詳細設計）に必要な情報が全て含まれている
- [ ] 次フェーズへの引き継ぎ事項が明確
- [ ] Phase 04用プロンプトが生成されている

### 8.2 次プロンプト生成のタイミング
以下のいずれかの条件を満たした時：

1. **定期的な生成**
   - Phase 03の全タスクが完了した時
   - チャットのトークン使用量が70%を超えた時

2. **臨時の生成**
   - プロジェクト方針の大幅変更があった時
   - 予期しない問題が発生し、チャットを切り替える必要がある時

### 8.3 次プロンプトに含めるべき情報

1. **Phase 03の成果**
   - 完了したタスク一覧
   - 作成した設計書一覧（14ファイル）
   - 設計で明確になった技術的ポイント

2. **Phase 04の準備**
   - Phase 04（詳細設計）の作業内容
   - 参照すべき設計書
   - 特別な注意事項

3. **規約の更新**
   - Phase 03で追加・変更した規約（あれば）
   - 追加の制約事項（あれば）

**重要**: Phase 04用プロンプトは `01_規約/プロンプト生成規約書.md` に従って作成すること。

---

## 9. 特別指示事項

### 9.1 AI動作への指示
以下の指示を厳守してください：

**必須動作**:
- チャット開始時、必ず開発規約書、コーディング規約書、画面設計基本方針を確認すること
- 設計書は詳細かつ具体的に記載すること（製造に進める品質）
- 設計書作成時は必ずPhase 02の分析資料を参照すること
- 成果物は必ず作業ディレクトリに出力すること
- ファイル出力時は必ずパスの存在を確認すること

**禁止動作**:
- チャット内に設計書の全文を出力しないこと（報告のみ）
- 規約に違反する設計をしないこと
- Phase 02の分析結果を無視した設計をしないこと
- パスの確認なしにファイルを出力しないこと

**推奨動作**:
- 設計書は段階的に作成すること（一度に全部作成しない）
- 定期的に進捗を報告すること
- 設計書間の整合性を確認すること

### 9.2 エラー時の対応手順

**パスエラー**:
1. ディレクトリの存在を確認
2. パスの記述（\記号）を確認
3. 必要に応じてディレクトリを作成

**ファイル読み込みエラー**:
1. ファイルの存在を確認
2. 文字コードを確認
3. 分割読み込みを試行

**設計の矛盾エラー**:
1. Phase 02の分析資料を再確認
2. 画面設計基本方針を再確認
3. 設計書間の整合性を確認

### 9.3 報告形式
作業完了時は以下の形式で報告してください：

```markdown
## Phase 03 作業完了報告

### 完了タスク
- [x] ディレクトリ作成
- [x] 画面設計書作成（login, main, input_dialog, master）
- [x] 機能設計書作成（auth, search, crud, product_select, template_select, master_maintenance）
- [x] その他設計書作成（system_overview, data_flow, api_spec）
- [x] Phase 04用プロンプト生成

### 作成成果物
| No | ファイル名 | 格納場所 | 状態 |
|----|-----------|---------|------|
| 1 | login.md | 03_設計/画面設計書/ | ✓完了 |
| ... | ... | ... | ... |

### Phase 04への引き継ぎ事項
- [重要な引き継ぎ事項]

### 設計で明確になった技術的ポイント
- [技術的ポイント]

### Phase 04用プロンプト
- 格納場所: `00_プロンプト/Phase03_to_Phase04.md`
- 作成状態: ✓完了
```

---

## 10. チェックリスト

### 10.1 Phase開始時のチェックリスト
- [ ] プロンプト全体を読み込んだ
- [ ] プロジェクト概要を理解した
- [ ] 作業ディレクトリの存在を確認した
- [ ] 必須ドキュメントを確認した（開発規約書、コーディング規約書、画面設計基本方針）
- [ ] Phase 02の成果物を確認した（分析資料10本）
- [ ] Phase 03のタスクを理解した（設計書14本作成）
- [ ] 規約・制約を理解した
- [ ] 初期タスクを開始できる状態

### 10.2 設計書作成時のチェックリスト
各設計書作成時に以下を確認：

- [ ] Phase 02の分析結果を参照した
- [ ] 画面設計基本方針に準拠している
- [ ] 必須記載項目が全て含まれている
- [ ] レイアウト図が含まれている（画面設計書）
- [ ] 処理フローが明確に記載されている
- [ ] バリデーション仕様が明確
- [ ] データベース連携が明確（使用テーブル・SP）
- [ ] エラーハンドリングが定義されている
- [ ] 他の設計書との整合性が取れている

### 10.3 Phase終了時のチェックリスト
- [ ] 全てのタスクが完了している
- [ ] 全ての成果物が作成されている（設計書13本 + プロンプト1本）
- [ ] 成果物が正しい場所に格納されている
- [ ] 設計書が完成している（製造に進める品質）
- [ ] 設計書間に矛盾がない
- [ ] Phase 02の分析結果が適切に反映されている
- [ ] Phase 04への引き継ぎ事項が明確
- [ ] Phase 04用プロンプトが生成されている（プロンプト生成規約書に従う）
- [ ] 完了報告が作成されている

---

## 11. 参考情報

### 11.1 プロジェクト関連ドキュメント
- **開発規約書**: `01_規約/開発規約書.md（v1.1）`
- **コーディング規約書**: `01_規約/コーディング規約書.md`
- **ディレクトリ構造設計書**: `01_規約/ディレクトリ構造設計書.md`
- **プロジェクト工程表**: `01_規約/プロジェクト工程表.md`
- **プロンプト生成規約書**: `01_規約/プロンプト生成規約書.md`
- **画面設計基本方針**: `01_規約/画面設計基本方針.md`

### 11.2 Phase 02分析資料
- **テーブル定義書**: `02_分析/テーブル定義書.md`
- **ストアドプロシージャ一覧**: `02_分析/ストアドプロシージャ一覧.md`
- **VBA処理分析結果**: `02_分析/VBA処理分析結果.md`
- **クエリ定義一覧**: `02_分析/クエリ定義一覧.md`
- **画面構成一覧**: `02_分析/画面構成一覧.md`
- **画面遷移図**: `02_分析/画面遷移図.md`
- **機能要件定義書**: `02_分析/機能要件定義書.md`
- **データ移行方針**: `02_分析/データ移行方針.md`
- **参考システム分析結果**: `02_分析/参考システム分析結果.md`
- **非機能要件定義書**: `02_分析/非機能要件定義書.md`

### 11.3 データベース
- **サーバー**: SQL Server 2022
- **接続方法**: PDO（SQL Server Native Client）
- **データ操作**: ストアドプロシージャ優先

---

## 12. 補足事項

### 12.1 Phase 03の成功基準

**完了条件**:
以下の全ての成果物が作成され、Phase 04（詳細設計）に進める状態になっていること：

1. ✅ 画面設計書4本（login, main, input_dialog, master）
2. ✅ 機能設計書6本（auth, search, crud, product_select, template_select, master_maintenance）
3. ✅ システム全体設計書（system_overview）
4. ✅ データフロー図（data_flow）
5. ✅ 内部API設計書（api_spec）
6. ✅ Phase 04用プロンプト（Phase03_to_Phase04.md）

**品質基準**:
- 全ての設計書が画面設計基本方針に準拠している
- 設計書間で矛盾がない
- Phase 02の分析結果が適切に反映されている
- Phase 04（詳細設計）に必要な情報が全て含まれている
- 製造（Phase 05）を開始できるレベルの設計になっている

### 12.2 設計時の重点ポイント

1. **ユーザビリティ**: 既存Accessシステムからの移行をスムーズに
2. **レスポンシブ**: PC/Tablet/SPで最適な表示と操作性
3. **保守性**: モジュール化された設計、共通処理の関数化
4. **性能**: レスポンスタイム目標を達成（非機能要件参照）
5. **整合性**: 設計書間、Phase 02分析結果との整合性

---

**作成者**: Claude AI  
**承認者**: （プロジェクト責任者）  
**改訂履歴**:
- v1.0 (2025-11-25): 初版作成（Phase 02完了後）
- v2.0 (2025-11-25): プロンプト生成規約書に準拠した全面改訂
